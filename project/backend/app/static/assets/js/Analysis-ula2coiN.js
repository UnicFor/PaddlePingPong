import{e as H,l as Me,H as Be,I as me,c as L,o as N,a as r,f as se,n as we,t as B,j as Oe,F as Re,r as $e,b as fe,w as he,v as Ue,q as Le,u as ze,m as ke,h as be,E as xe,J as Ve}from"./index-D95vXK_I.js";import{i as Ee,L as Ze}from"./index-C91cXZ9t.js";import{a as Ne}from"./index-BtuGy7By.js";import{_ as ge}from"./Logo-Br9VKzPa.js";import{u as He}from"./Main-Bq42Prz2.js";function Ke(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ie={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var We=Ie.exports,qe;function Ye(){return qe||(qe=1,function(s,n){((u,i)=>{s.exports=i()})(We,function u(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},o,h=!i.document&&!!i.postMessage,C=i.IS_PAPA_WORKER||!1,S={},z=0,v={};function X(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var a=Se(t);a.chunkSize=parseInt(a.chunkSize),t.step||t.chunk||(a.chunkSize=null),this._handle=new ne(a),(this._handle.streamer=this)._config=a}).call(this,e),this.parseChunk=function(t,a){var p=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<p){let F=this._config.newline;F||(f=this._config.quoteChar||'"',F=this._handle.guessLineEndings(t,f)),t=[...t.split(F).slice(p)].join(F)}this.isFirstChunk&&T(this._config.beforeFirstChunk)&&(f=this._config.beforeFirstChunk(t))!==void 0&&(t=f),this.isFirstChunk=!1,this._halted=!1;var p=this._partialLine+t,f=(this._partialLine="",this._handle.parse(p,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=f.meta.cursor,p=(this._finished||(this._partialLine=p.substring(t-this._baseIndex),this._baseIndex=t),f&&f.data&&(this._rowCount+=f.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),C)i.postMessage({results:f,workerId:v.WORKER_ID,finished:p});else if(T(this._config.chunk)&&!a){if(this._config.chunk(f,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=f=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(f.data),this._completeResults.errors=this._completeResults.errors.concat(f.errors),this._completeResults.meta=f.meta),this._completed||!p||!T(this._config.complete)||f&&f.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||f&&f.meta.paused||this._nextChunk(),f}this._halted=!0},this._sendError=function(t){T(this._config.error)?this._config.error(t):C&&this._config.error&&i.postMessage({workerId:v.WORKER_ID,error:t,finished:!1})}}function P(e){var t;(e=e||{}).chunkSize||(e.chunkSize=v.RemoteChunkSize),X.call(this,e),this._nextChunk=h?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),h||(t.onload=ae(this._chunkLoaded,this),t.onerror=ae(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!h),this._config.downloadRequestHeaders){var a,p=this._config.downloadRequestHeaders;for(a in p)t.setRequestHeader(a,p[a])}var f;this._config.chunkSize&&(f=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+f));try{t.send(this._config.downloadRequestBody)}catch(F){this._chunkError(F.message)}h&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(a){a=t.statusText||a,this._sendError(new Error(a))}}function _(e){(e=e||{}).chunkSize||(e.chunkSize=v.LocalChunkSize),X.call(this,e);var t,a,p=typeof FileReader<"u";this.stream=function(f){this._input=f,a=f.slice||f.webkitSlice||f.mozSlice,p?((t=new FileReader).onload=ae(this._chunkLoaded,this),t.onerror=ae(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var f=this._input,F=(this._config.chunkSize&&(F=Math.min(this._start+this._config.chunkSize,this._input.size),f=a.call(f,this._start,F)),t.readAsText(f,this._config.encoding));p||this._chunkLoaded({target:{result:F}})},this._chunkLoaded=function(f){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(f.target.result)},this._chunkError=function(){this._sendError(t.error)}}function Q(e){var t;X.call(this,e=e||{}),this.stream=function(a){return t=a,this._nextChunk()},this._nextChunk=function(){var a,p;if(!this._finished)return a=this._config.chunkSize,t=a?(p=t.substring(0,a),t.substring(a)):(p=t,""),this._finished=!t,this.parseChunk(p)}}function te(e){X.call(this,e=e||{});var t=[],a=!0,p=!1;this.pause=function(){X.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){X.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(f){this._input=f,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){p&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):a=!0},this._streamData=ae(function(f){try{t.push(typeof f=="string"?f:f.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(F){this._streamError(F)}},this),this._streamError=ae(function(f){this._streamCleanUp(),this._sendError(f)},this),this._streamEnd=ae(function(){this._streamCleanUp(),p=!0,this._streamData("")},this),this._streamCleanUp=ae(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ne(e){var t,a,p,f,F=Math.pow(2,53),W=-F,x=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,d=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,w=0,c=0,R=!1,y=!1,k=[],m={data:[],errors:[],meta:{}};function j(b){return e.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function O(){if(m&&p&&(q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+v.DefaultDelimiter+"'"),p=!1),e.skipEmptyLines&&(m.data=m.data.filter(function(g){return!j(g)})),K()){let g=function(I,M){T(e.transformHeader)&&(I=e.transformHeader(I,M)),k.push(I)};if(m)if(Array.isArray(m.data[0])){for(var b=0;K()&&b<m.data.length;b++)m.data[b].forEach(g);m.data.splice(0,1)}else m.data.forEach(g)}function A(g,I){for(var M=e.header?{}:[],U=0;U<g.length;U++){var V=U,E=g[U],E=((re,D)=>(Z=>(e.dynamicTypingFunction&&e.dynamicTyping[Z]===void 0&&(e.dynamicTyping[Z]=e.dynamicTypingFunction(Z)),(e.dynamicTyping[Z]||e.dynamicTyping)===!0))(re)?D==="true"||D==="TRUE"||D!=="false"&&D!=="FALSE"&&((Z=>{if(x.test(Z)&&(Z=parseFloat(Z),W<Z&&Z<F))return 1})(D)?parseFloat(D):d.test(D)?new Date(D):D===""?null:D):D)(V=e.header?U>=k.length?"__parsed_extra":k[U]:V,E=e.transform?e.transform(E,V):E);V==="__parsed_extra"?(M[V]=M[V]||[],M[V].push(E)):M[V]=E}return e.header&&(U>k.length?q("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+U,c+I):U<k.length&&q("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+U,c+I)),M}var $;m&&(e.header||e.dynamicTyping||e.transform)&&($=1,!m.data.length||Array.isArray(m.data[0])?(m.data=m.data.map(A),$=m.data.length):m.data=A(m.data,0),e.header&&m.meta&&(m.meta.fields=k),c+=$)}function K(){return e.header&&k.length===0}function q(b,A,$,g){b={type:b,code:A,message:$},g!==void 0&&(b.row=g),m.errors.push(b)}T(e.step)&&(f=e.step,e.step=function(b){m=b,K()?O():(O(),m.data.length!==0&&(w+=b.data.length,e.preview&&w>e.preview?a.abort():(m.data=m.data[0],f(m,l))))}),this.parse=function(b,A,$){var g=e.quoteChar||'"',g=(e.newline||(e.newline=this.guessLineEndings(b,g)),p=!1,e.delimiter?T(e.delimiter)&&(e.delimiter=e.delimiter(b),m.meta.delimiter=e.delimiter):((g=((I,M,U,V,E)=>{var re,D,Z,ce;E=E||[",","	","|",";",v.RECORD_SEP,v.UNIT_SEP];for(var _e=0;_e<E.length;_e++){for(var ie,Ce=E[_e],J=0,oe=0,Y=0,ee=(Z=void 0,new G({comments:V,delimiter:Ce,newline:M,preview:10}).parse(I)),ue=0;ue<ee.data.length;ue++)U&&j(ee.data[ue])?Y++:(ie=ee.data[ue].length,oe+=ie,Z===void 0?Z=ie:0<ie&&(J+=Math.abs(ie-Z),Z=ie));0<ee.data.length&&(oe/=ee.data.length-Y),(D===void 0||J<=D)&&(ce===void 0||ce<oe)&&1.99<oe&&(D=J,re=Ce,ce=oe)}return{successful:!!(e.delimiter=re),bestDelimiter:re}})(b,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=g.bestDelimiter:(p=!0,e.delimiter=v.DefaultDelimiter),m.meta.delimiter=e.delimiter),Se(e));return e.preview&&e.header&&g.preview++,t=b,a=new G(g),m=a.parse(t,A,$),O(),R?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return R},this.pause=function(){R=!0,a.abort(),t=T(e.chunk)?"":t.substring(a.getCharIndex())},this.resume=function(){l.streamer._halted?(R=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,a.abort(),m.meta.aborted=!0,T(e.complete)&&e.complete(m),t=""},this.guessLineEndings=function(I,g){I=I.substring(0,1048576);var g=new RegExp(de(g)+"([^]*?)"+de(g),"gm"),$=(I=I.replace(g,"")).split("\r"),g=I.split(`
`),I=1<g.length&&g[0].length<$[0].length;if($.length===1||I)return`
`;for(var M=0,U=0;U<$.length;U++)$[U][0]===`
`&&M++;return M>=$.length/2?`\r
`:"\r"}}function de(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function G(e){var t=(e=e||{}).delimiter,a=e.newline,p=e.comments,f=e.step,F=e.preview,W=e.fastMode,x=null,d=!1,l=e.quoteChar==null?'"':e.quoteChar,w=l;if(e.escapeChar!==void 0&&(w=e.escapeChar),(typeof t!="string"||-1<v.BAD_DELIMITERS.indexOf(t))&&(t=","),p===t)throw new Error("Comment character same as delimiter");p===!0?p="#":(typeof p!="string"||-1<v.BAD_DELIMITERS.indexOf(p))&&(p=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var c=0,R=!1;this.parse=function(y,k,m){if(typeof y!="string")throw new Error("Input must be a string");var j=y.length,O=t.length,K=a.length,q=p.length,b=T(f),A=[],$=[],g=[],I=c=0;if(!y)return J();if(W||W!==!1&&y.indexOf(l)===-1){for(var M=y.split(a),U=0;U<M.length;U++){if(g=M[U],c+=g.length,U!==M.length-1)c+=a.length;else if(m)return J();if(!p||g.substring(0,q)!==p){if(b){if(A=[],ce(g.split(t)),oe(),R)return J()}else ce(g.split(t));if(F&&F<=U)return A=A.slice(0,F),J(!0)}}return J()}for(var V=y.indexOf(t,c),E=y.indexOf(a,c),re=new RegExp(de(w)+de(l),"g"),D=y.indexOf(l,c);;)if(y[c]===l)for(D=c,c++;;){if((D=y.indexOf(l,D+1))===-1)return m||$.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:A.length,index:c}),ie();if(D===j-1)return ie(y.substring(c,D).replace(re,l));if(l===w&&y[D+1]===w)D++;else if(l===w||D===0||y[D-1]!==w){V!==-1&&V<D+1&&(V=y.indexOf(t,D+1));var Z=_e((E=E!==-1&&E<D+1?y.indexOf(a,D+1):E)===-1?V:Math.min(V,E));if(y.substr(D+1+Z,O)===t){g.push(y.substring(c,D).replace(re,l)),y[c=D+1+Z+O]!==l&&(D=y.indexOf(l,c)),V=y.indexOf(t,c),E=y.indexOf(a,c);break}if(Z=_e(E),y.substring(D+1+Z,D+1+Z+K)===a){if(g.push(y.substring(c,D).replace(re,l)),Ce(D+1+Z+K),V=y.indexOf(t,c),D=y.indexOf(l,c),b&&(oe(),R))return J();if(F&&A.length>=F)return J(!0);break}$.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:A.length,index:c}),D++}}else if(p&&g.length===0&&y.substring(c,c+q)===p){if(E===-1)return J();c=E+K,E=y.indexOf(a,c),V=y.indexOf(t,c)}else if(V!==-1&&(V<E||E===-1))g.push(y.substring(c,V)),c=V+O,V=y.indexOf(t,c);else{if(E===-1)break;if(g.push(y.substring(c,E)),Ce(E+K),b&&(oe(),R))return J();if(F&&A.length>=F)return J(!0)}return ie();function ce(Y){A.push(Y),I=c}function _e(Y){var ee=0;return ee=Y!==-1&&(Y=y.substring(D+1,Y))&&Y.trim()===""?Y.length:ee}function ie(Y){return m||(Y===void 0&&(Y=y.substring(c)),g.push(Y),c=j,ce(g),b&&oe()),J()}function Ce(Y){c=Y,ce(g),g=[],E=y.indexOf(a,c)}function J(Y){if(e.header&&!k&&A.length&&!d){var ee=A[0],ue={},Te=new Set(ee);let Pe=!1;for(let ye=0;ye<ee.length;ye++){let le=ee[ye];if(ue[le=T(e.transformHeader)?e.transformHeader(le,ye):le]){let Ae,je=ue[le];for(;Ae=le+"_"+je,je++,Te.has(Ae););Te.add(Ae),ee[ye]=Ae,ue[le]++,Pe=!0,(x=x===null?{}:x)[Ae]=le}else ue[le]=1,ee[ye]=le;Te.add(le)}Pe&&console.warn("Duplicate headers found and renamed."),d=!0}return{data:A,errors:$,meta:{delimiter:t,linebreak:a,aborted:R,truncated:!!Y,cursor:I+(k||0),renamedHeaders:x}}}function oe(){f(J()),A=[],$=[]}},this.abort=function(){R=!0},this.getCharIndex=function(){return c}}function pe(e){var t=e.data,a=S[t.workerId],p=!1;if(t.error)a.userError(t.error,t.file);else if(t.results&&t.results.data){var f={abort:function(){p=!0,ve(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:De,resume:De};if(T(a.userStep)){for(var F=0;F<t.results.data.length&&(a.userStep({data:t.results.data[F],errors:t.results.errors,meta:t.results.meta},f),!p);F++);delete t.results}else T(a.userChunk)&&(a.userChunk(t.results,f,t.file),delete t.results)}t.finished&&!p&&ve(t.workerId,t.results)}function ve(e,t){var a=S[e];T(a.userComplete)&&a.userComplete(t),a.terminate(),delete S[e]}function De(){throw new Error("Not implemented.")}function Se(e){if(typeof e!="object"||e===null)return e;var t,a=Array.isArray(e)?[]:{};for(t in e)a[t]=Se(e[t]);return a}function ae(e,t){return function(){e.apply(t,arguments)}}function T(e){return typeof e=="function"}return v.parse=function(e,t){var a=(t=t||{}).dynamicTyping||!1;if(T(a)&&(t.dynamicTypingFunction=a,a={}),t.dynamicTyping=a,t.transform=!!T(t.transform)&&t.transform,!t.worker||!v.WORKERS_SUPPORTED)return a=null,v.NODE_STREAM_INPUT,typeof e=="string"?(e=(p=>p.charCodeAt(0)!==65279?p:p.slice(1))(e),a=new(t.download?P:Q)(t)):e.readable===!0&&T(e.read)&&T(e.on)?a=new te(t):(i.File&&e instanceof File||e instanceof Object)&&(a=new _(t)),a.stream(e);(a=(()=>{var p;return!!v.WORKERS_SUPPORTED&&(p=(()=>{var f=i.URL||i.webkitURL||null,F=u.toString();return v.BLOB_URL||(v.BLOB_URL=f.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",F,")();"],{type:"text/javascript"})))})(),(p=new i.Worker(p)).onmessage=pe,p.id=z++,S[p.id]=p)})()).userStep=t.step,a.userChunk=t.chunk,a.userComplete=t.complete,a.userError=t.error,t.step=T(t.step),t.chunk=T(t.chunk),t.complete=T(t.complete),t.error=T(t.error),delete t.worker,a.postMessage({input:e,config:t,workerId:a.id})},v.unparse=function(e,t){var a=!1,p=!0,f=",",F=`\r
`,W='"',x=W+W,d=!1,l=null,w=!1,c=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||v.BAD_DELIMITERS.filter(function(k){return t.delimiter.indexOf(k)!==-1}).length||(f=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(a=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(d=t.skipEmptyLines),typeof t.newline=="string"&&(F=t.newline),typeof t.quoteChar=="string"&&(W=t.quoteChar),typeof t.header=="boolean"&&(p=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");l=t.columns}t.escapeChar!==void 0&&(x=t.escapeChar+W),t.escapeFormulae instanceof RegExp?w=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(w=/^[=+\-@\t\r].*$/)}})(),new RegExp(de(W),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return R(null,e,d);if(typeof e[0]=="object")return R(l||Object.keys(e[0]),e,d)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||l),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),R(e.fields||[],e.data||[],d);throw new Error("Unable to serialize unrecognized input");function R(k,m,j){var O="",K=(typeof k=="string"&&(k=JSON.parse(k)),typeof m=="string"&&(m=JSON.parse(m)),Array.isArray(k)&&0<k.length),q=!Array.isArray(m[0]);if(K&&p){for(var b=0;b<k.length;b++)0<b&&(O+=f),O+=y(k[b],b);0<m.length&&(O+=F)}for(var A=0;A<m.length;A++){var $=(K?k:m[A]).length,g=!1,I=K?Object.keys(m[A]).length===0:m[A].length===0;if(j&&!K&&(g=j==="greedy"?m[A].join("").trim()==="":m[A].length===1&&m[A][0].length===0),j==="greedy"&&K){for(var M=[],U=0;U<$;U++){var V=q?k[U]:U;M.push(m[A][V])}g=M.join("").trim()===""}if(!g){for(var E=0;E<$;E++){0<E&&!I&&(O+=f);var re=K&&q?k[E]:E;O+=y(m[A][re],E)}A<m.length-1&&(!j||0<$&&!I)&&(O+=F)}}return O}function y(k,m){var j,O;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):(O=!1,w&&typeof k=="string"&&w.test(k)&&(k="'"+k,O=!0),j=k.toString().replace(c,x),(O=O||a===!0||typeof a=="function"&&a(k,m)||Array.isArray(a)&&a[m]||((K,q)=>{for(var b=0;b<q.length;b++)if(-1<K.indexOf(q[b]))return!0;return!1})(j,v.BAD_DELIMITERS)||-1<j.indexOf(f)||j.charAt(0)===" "||j.charAt(j.length-1)===" ")?W+j+W:j)}},v.RECORD_SEP="",v.UNIT_SEP="",v.BYTE_ORDER_MARK="\uFEFF",v.BAD_DELIMITERS=["\r",`
`,'"',v.BYTE_ORDER_MARK],v.WORKERS_SUPPORTED=!h&&!!i.Worker,v.NODE_STREAM_INPUT=1,v.LocalChunkSize=10485760,v.RemoteChunkSize=5242880,v.DefaultDelimiter=",",v.Parser=G,v.ParserHandle=ne,v.NetworkStreamer=P,v.FileStreamer=_,v.StringStreamer=Q,v.ReadableStreamStreamer=te,i.jQuery&&((o=i.jQuery).fn.parse=function(e){var t=e.config||{},a=[];return this.each(function(F){if(!(o(this).prop("tagName").toUpperCase()==="INPUT"&&o(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var W=0;W<this.files.length;W++)a.push({file:this.files[W],inputElem:this,instanceConfig:o.extend({},t)})}),p(),this;function p(){if(a.length===0)T(e.complete)&&e.complete();else{var F,W,x,d,l=a[0];if(T(e.before)){var w=e.before(l.file,l.inputElem);if(typeof w=="object"){if(w.action==="abort")return F="AbortError",W=l.file,x=l.inputElem,d=w.reason,void(T(e.error)&&e.error({name:F},W,x,d));if(w.action==="skip")return void f();typeof w.config=="object"&&(l.instanceConfig=o.extend(l.instanceConfig,w.config))}else if(w==="skip")return void f()}var c=l.instanceConfig.complete;l.instanceConfig.complete=function(R){T(c)&&c(R,l.file,l.inputElem),f()},v.parse(l.file,l.instanceConfig)}}function f(){a.splice(0,1),p()}}),C&&(i.onmessage=function(e){e=e.data,v.WORKER_ID===void 0&&e&&(v.WORKER_ID=e.workerId),typeof e.input=="string"?i.postMessage({workerId:v.WORKER_ID,results:v.parse(e.input,e.config),finished:!0}):(i.File&&e.input instanceof File||e.input instanceof Object)&&(e=v.parse(e.input,e.config))&&i.postMessage({workerId:v.WORKER_ID,results:e,finished:!0})}),(P.prototype=Object.create(X.prototype)).constructor=P,(_.prototype=Object.create(X.prototype)).constructor=_,(Q.prototype=Object.create(Q.prototype)).constructor=Q,(te.prototype=Object.create(X.prototype)).constructor=te,v})}(Ie)),Ie.exports}var Xe=Ye();const Qe=Ke(Xe),Je={__name:"AngleChart",props:{angles:{type:Object,required:!0}},setup(s){const n=s,u=H(null);let i=null;const o=()=>{u.value&&(i=Ee(u.value),h())},h=()=>{if(!i)return;const C={tooltip:{trigger:"axis",formatter:"{b}: {c}°"},legend:{data:["左肘角度","右肘角度","身体扭转"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:["平均动作角度"]},yAxis:{type:"value",name:"角度(°)",min:0,max:180,axisLabel:{formatter:"{value}°"}},series:[{name:"左肘角度",type:"bar",data:[n.angles.leftElbowAngle||0],itemStyle:{color:"#3498db"},markLine:{data:[{yAxis:90,name:"最佳角度",lineStyle:{color:"green"}}]}},{name:"右肘角度",type:"bar",data:[n.angles.rightElbowAngle||0],itemStyle:{color:"#e74c3c"}},{name:"身体扭转",type:"bar",data:[n.angles.torsoRotationAngle||0],itemStyle:{color:"#9b59b6"}}]};i.setOption(C)};return Me(o),Be(()=>{i&&i.dispose()}),me(()=>n.angles,h,{deep:!0}),(C,S)=>(N(),L("div",{ref_key:"chartContainer",ref:u,style:{width:"100%",height:"300px"}},null,512))}},Ge={class:"stat-card"},et={class:"angle-grid"},tt={key:0,class:"angle-item"},st={key:1,class:"angle-item"},nt={key:2,class:"angle-item"},rt={__name:"AngleDataDisplay",props:{angles:{type:Object,required:!0}},setup(s){const n=(u,i,o,h)=>u>=o&&u<=h?Math.abs(u-i)<=10?"status-good":"status-warning":"status-bad";return(u,i)=>(N(),L("div",Ge,[i[3]||(i[3]=r("h3",{class:"stat-title"},"实时角度监测",-1)),r("div",et,[s.angles.leftElbowAngle!==void 0?(N(),L("div",tt,[i[0]||(i[0]=r("div",{class:"angle-meta"},[r("span",{class:"stat-label"},"左肘弯曲"),r("span",{class:"stat-unit"},"基准: 90°")],-1)),r("span",{class:we(["stat-value",n(s.angles.leftElbowAngle,90,70,130)])},B(s.angles.leftElbowAngle.toFixed(1))+"° ",3)])):se("",!0),s.angles.rightElbowAngle!==void 0?(N(),L("div",st,[i[1]||(i[1]=r("div",{class:"angle-meta"},[r("span",{class:"stat-label"},"右肘弯曲"),r("span",{class:"stat-unit"},"基准: 90°")],-1)),r("span",{class:we(["stat-value",n(s.angles.rightElbowAngle,90,70,130)])},B(s.angles.rightElbowAngle.toFixed(1))+"° ",3)])):se("",!0),s.angles.torsoRotationAngle!==void 0?(N(),L("div",nt,[i[2]||(i[2]=r("div",{class:"angle-meta"},[r("span",{class:"stat-label"},"躯干扭转"),r("span",{class:"stat-unit"},"基准: 10°")],-1)),r("span",{class:we(["stat-value",n(s.angles.torsoRotationAngle,10,0,30)])},B(s.angles.torsoRotationAngle.toFixed(1))+"° ",3)])):se("",!0)])]))}},at=ge(rt,[["__scopeId","data-v-4c84b2bb"]]),Fe=ze(),it={name:"AnalysisCharts",components:{AngleDataDisplay:at,AngleChart:Je},props:{videoId:{type:String,required:!0}},data(){return{stats:[],charts:{combined:null,scatter:null,timeline:null},currentFrameIndex:0,maxFrameIndex:0,frameDataList:[],currentFrame:null,processedData:null,currentAngles:{},poseData:null}},computed:{maxFrameIndex(){return this.processedData?this.processedData.frameData.length-1:null},frameStyle(){return this.currentFrame?{backgroundImage:`url(${this.currentFrame})`}:{}}},async mounted(){this.setupAxiosInterceptor(),await this.initCharts(),window.addEventListener("resize",this.handleResize),window.debugAngles=()=>{console.log("当前角度数据:",this.currentAngles),console.log("骨骼数据:",this.poseData),console.log("当前帧索引:",this.currentFrameIndex)}},beforeUnmount(){window.removeEventListener("resize",this.handleResize),Object.values(this.charts).forEach(s=>s==null?void 0:s.dispose())},methods:{calculateKeyAngles(s){const n={};if(s.left_shoulder&&s.left_elbow&&s.left_wrist&&(n.leftElbowAngle=this.calculateBendAngle(s.left_shoulder.position,s.left_elbow.position,s.left_wrist.position)),s.right_shoulder&&s.right_elbow&&s.right_wrist&&(n.rightElbowAngle=this.calculateBendAngle(s.right_shoulder.position,s.right_elbow.position,s.right_wrist.position)),s.left_shoulder&&s.right_shoulder&&s.left_hip&&s.right_hip){const u=this.calculateAngle(s.left_shoulder.position,s.right_shoulder.position),i=this.calculateAngle(s.left_hip.position,s.right_hip.position);let o=Math.abs(u-i);o>200&&(o=Math.abs(o-360)),n.torsoRotationAngle=Math.min(o,80.4)}return n},calculateAngle(s,n){const u=n[1]-s[1],i=n[0]-s[0];return Math.atan2(u,i)*(180/Math.PI)},calculateBendAngle(s,n,u){const i=[s[0]-n[0],s[1]-n[1]],o=[u[0]-n[0],u[1]-n[1]],h=i[0]*o[0]+i[1]*o[1],C=Math.sqrt(i[0]**2+i[1]**2),S=Math.sqrt(o[0]**2+o[1]**2);return Math.acos(Math.max(-1,Math.min(1,h/(C*S))))*(180/Math.PI)},handleAngleFrameChange(){this.charts.timeline&&this.charts.timeline.dispatchAction({type:"timelineChange",currentIndex:this.currentFrameIndex}),this.updateAnglesForCurrentFrame()},safeGetData(s){return this.currentFrameIndex=s,this.updateAnglesForCurrentFrame(),this.processedData.xyFrameSpeedData[s]||[0,0,0,0]},setupAxiosInterceptor(){Ne.interceptors.request.use(s=>(localStorage.getItem("jwt_token")&&(s.headers.Authorization=`Bearer ${Fe.token}`),s),s=>Promise.reject(s)),Ne.interceptors.response.use(s=>s,s=>{var n;return((n=s.response)==null?void 0:n.status)===401&&this.$router.push("/login"),Promise.reject(s)})},async initCharts(){try{const s=await this.loadCSVData();await this.loadFrameData(),this.poseData=await this.loadPoseData(),this.processedData=this.processData(s),this.stats=this.createStats(this.processedData.stats),this.initChartInstances(),this.updateAnglesForCurrentFrame()}catch(s){console.error("初始化失败:",s),Notification.error({title:"错误",message:"数据加载失败",duration:3e3})}},async loadCSVData(){try{const n=await(await fetch(`/api/ball-data/${this.videoId}`,{headers:{Authorization:`Bearer ${Fe.token}`,"Content-Type":"text/csv"}})).text();return new Promise(u=>{Qe.parse(n,{header:!0,dynamicTyping:!0,complete:i=>{u(i.data.filter(o=>o.Frame!==null&&!isNaN(o.X)&&!isNaN(o.Y)&&!isNaN(o.Speed)))}})})}catch(s){throw console.error("加载CSV数据失败:",s),s}},async loadFrameData(){try{const n=await(await fetch(`/api/frames-batch/${this.videoId}`,{headers:{Authorization:`Bearer ${Fe.token}`}})).json();return this.frameDataList=n.frames,n.frames}catch(s){throw console.error("加载帧数据失败:",s),this.frameDataList=[],s}},async loadPoseData(){try{const n=await(await fetch(`/api/pose-data/${this.videoId}`,{headers:{Authorization:`Bearer ${Fe.token}`}})).json();return{meta_info:n.data.meta_info,instance_info:n.data.instance_info.map(u=>({frame_id:Number(u.frame_id),instances:u.instances.map(i=>({bbox:i.bbox,keypoints:i.keypoints,keypoint_scores:i.keypoint_scores}))}))}}catch(s){return console.error("加载骨骼数据失败:",s),null}},updateAnglesForCurrentFrame(){var n,u;if(!this.poseData)return;const s=this.poseData.instance_info.find(i=>i.frame_id===this.processedData.frameData[this.currentFrameIndex]);if((u=(n=s==null?void 0:s.instances)==null?void 0:n[0])!=null&&u.keypoints){const i={},o=this.poseData.meta_info.keypoint_id2name||{};s.instances[0].keypoints.forEach((h,C)=>{o[C]&&(i[o[C]]={position:h,score:s.instances[0].keypoint_scores[C]})}),this.currentAngles=this.calculateKeyAngles(i)}},processData(s){const n=[],u=[],i=[],o=[],h=[],C=[];s.forEach(_=>{n.push(Number(_.Frame)),!isNaN(_.X)&&!isNaN(_.Y)?(u.push(_.X),i.push(_.Y),h.push([_.X,_.Y,_.Frame,_.Speed||0])):(u.push(null),i.push(null)),o.push(isNaN(_.Speed)?null:_.Speed)});for(let _=0;_<h.length-1;_++)C.push([h[_][0],h[_][1]]),C.push([h[_+1][0],h[_+1][1]]),C.push([null,null]);const S=o.filter(_=>_!==null),z=Math.max(...S),v=S.reduce((_,Q)=>_+Q,0)/S.length,X=h.length,P=s.length;return{frameData:n,xData:u,yData:i,speedData:o,xyFrameSpeedData:h,xyConnectedData:C,stats:{maxSpeed:z.toFixed(2),avgSpeed:v.toFixed(2),validCoords:X,totalFrames:P,detectionRate:(X/P*100).toFixed(2)},xRange:{min:Math.min(...h.map(_=>_[0])),max:Math.max(...h.map(_=>_[0]))},yRange:{min:Math.min(...h.map(_=>_[1])),max:Math.max(...h.map(_=>_[1]))}}},createStats(s){return[{value:s.maxSpeed,label:"最大速度 (像素/秒)"},{value:s.avgSpeed,label:"平均速度 (像素/秒)"},{value:s.validCoords,label:"有效坐标数"},{value:s.totalFrames,label:"总有效帧数"},{value:`${s.detectionRate}%`,label:"球检测率"}]},initChartInstances(){this.charts.combined=this.createCombinedChart(),this.charts.scatter=this.createScatterChart(),this.charts.timeline=this.createTimelineChart()},createCombinedChart(){const s=Ee(this.$refs.combinedChart),n={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:u=>{let i=`第${u[0].axisValue}帧<br/>`;return u.forEach(o=>{o.value!=null&&(i+=`${o.seriesName}: ${o.seriesType==="bar"?o.value.toFixed(2):o.value}<br/>`)}),i}},legend:{data:["X坐标","Y坐标","速度"]},grid:[{left:"10%",right:"4%",top:"60px",height:"50%"},{left:"6%",right:"4%",top:"62%",height:"24%"}],xAxis:[{type:"category",data:this.processedData.frameData,gridIndex:0,axisLabel:{show:!1}},{type:"category",data:this.processedData.frameData,gridIndex:1}],yAxis:[{type:"value",name:"坐标",gridIndex:0,splitLine:{show:!1}},{type:"value",name:"速度 (像素/秒)",gridIndex:1,splitLine:{show:!1}}],series:[{name:"X坐标",type:"line",data:this.processedData.xData,symbol:"circle",symbolSize:8,itemStyle:{color:"#5470c6"}},{name:"Y坐标",type:"line",data:this.processedData.yData,symbol:"circle",symbolSize:8,itemStyle:{color:"#91cc75"}},{name:"速度",type:"bar",data:this.processedData.speedData,itemStyle:{color:new Ze(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:1,color:"#188df0"}])}}],dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100,bottom:5}]};return s.setOption(n),s},createScatterChart(){const s=Ee(this.$refs.scatterChart),n=this.processedData.xyFrameSpeedData.map(o=>[o[0],o[1],o[2],o[3]]),u=Math.max(...this.processedData.speedData.filter(o=>o!==null)),i={tooltip:{formatter:o=>`帧: ${o.value[2]}<br/>坐标: (${o.value[0].toFixed(1)}, ${o.value[1].toFixed(1)})<br/>速度: ${o.value[3].toFixed(2)} 像素/秒`},xAxis:{type:"value",min:this.processedData.xRange.min-50,max:this.processedData.xRange.max+50,axisLabel:{formatter:o=>o.toFixed(0)}},yAxis:{type:"value",inverse:!0,min:this.processedData.yRange.min-50,max:this.processedData.yRange.max+50,axisLabel:{formatter:o=>o.toFixed(0)}},visualMap:{min:0,max:u,dimension:3,right:10,inRange:{color:["#313695","#a50026"]}},series:[{type:"scatter",symbolSize:16,data:n,itemStyle:{borderColor:"#000",borderWidth:.5}},{type:"line",data:this.processedData.xyConnectedData,lineStyle:{opacity:.5},showSymbol:!1}]};return s.setOption(i),s},createTimelineChart(){const s=Ee(this.$refs.timelineChart),n=this.processedData.frameData.map((i,o)=>({title:{text:`球轨迹回放 - 第${i}帧`,left:"center"},series:[{name:"历史轨迹",type:"scatter",data:this.processedData.xyFrameSpeedData.filter(h=>h[2]<=i),symbolSize:10,itemStyle:{color:"#91cc75",opacity:.5}},{name:"当前位置",type:"effectScatter",data:[this.safeGetData(o)],symbolSize:20,rippleEffect:{brushType:"stroke"},itemStyle:{color:"#f4e925"}}]})),u={baseOption:{timeline:{axisType:"category",autoPlay:!0,playInterval:500,data:this.processedData.frameData,label:{formatter:i=>`帧${i}`}},grid:{left:"5%",right:"5%",bottom:"25%"},xAxis:{type:"value",min:this.processedData.xRange.min-50,max:this.processedData.xRange.max+50},yAxis:{type:"value",inverse:!0,min:this.processedData.yRange.min-50,max:this.processedData.yRange.max+50}},options:n};return s.on("timelinechanged",i=>{try{if(!this.frameDataList||this.frameDataList.length===0){this.currentFrame="";return}const o=Math.max(this.frameDataList.length-1,0),h=Math.min(i.currentIndex,o),C=Math.max(h,0);this.currentFrame=this.frameDataList[C]||""}catch(o){console.error("帧更新错误:",o)}}),s.setOption(u),s},handleResize(){Object.values(this.charts).forEach(s=>{s.resize({animation:{duration:300}})})}}},ot={class:"analysis-container"},lt={class:"container"},dt={class:"stats"},ut={class:"stat-value"},ct={class:"stat-label"},ht={class:"angle-analysis-section"},ft={class:"angle-chart-container"},pt={class:"angle-data-container"},mt={class:"angle-controls"},gt={class:"slider-container"},vt=["max"],_t={class:"dashboard"},yt={class:"chart-container"},bt={ref:"combinedChart",class:"chart"},xt={class:"chart-container"},kt={ref:"scatterChart",class:"chart"},wt={class:"chart-container full-width"},St={ref:"timelineChart",class:"chart"};function Ct(s,n,u,i,o,h){const C=Oe("AngleChart"),S=Oe("AngleDataDisplay");return N(),L("div",ot,[r("div",lt,[r("div",dt,[(N(!0),L(Re,null,$e(o.stats,z=>(N(),L("div",{key:z.label,class:"stat-card"},[r("div",ut,B(z.value),1),r("div",ct,B(z.label),1)]))),128))]),r("div",ht,[r("div",ft,[n[2]||(n[2]=r("h2",null,"关键角度分析",-1)),fe(C,{angles:o.currentAngles},null,8,["angles"])]),r("div",pt,[n[3]||(n[3]=r("h2",null,"角度数据表",-1)),fe(S,{angles:o.currentAngles},null,8,["angles"])]),r("div",mt,[r("div",gt,[he(r("input",{type:"range","onUpdate:modelValue":n[0]||(n[0]=z=>o.currentFrameIndex=z),min:0,max:h.maxFrameIndex,class:"angle-slider",onInput:n[1]||(n[1]=(...z)=>h.handleAngleFrameChange&&h.handleAngleFrameChange(...z))},null,40,vt),[[Ue,o.currentFrameIndex,void 0,{number:!0}]])])])]),r("div",_t,[r("div",yt,[n[4]||(n[4]=r("h2",null,"轨迹与速度组合图",-1)),r("div",bt,null,512)]),r("div",xt,[n[5]||(n[5]=r("h2",null,"球轨迹散点图",-1)),r("div",kt,null,512)]),r("div",wt,[n[6]||(n[6]=r("h2",null,"时间轴轨迹回放",-1)),r("div",St,[r("div",{class:"frame-background",style:Le(h.frameStyle)},null,4)],512)])])])])}const At=ge(it,[["render",Ct],["__scopeId","data-v-7af714c1"]]),Dt={class:"analysis-tabs"},Ft={class:"tab-nav"},Et=["onClick"],It={class:"tab-content"},Rt={key:0},$t={key:1},Tt={__name:"AnalysisTabs",props:{videoId:{type:String,required:!0}},setup(s){const n=H("分析报告"),u=H(["分析报告","可视化图表"]),i=s;return(o,h)=>(N(),L("div",Dt,[r("div",Ft,[(N(!0),L(Re,null,$e(u.value,C=>(N(),L("button",{key:C,class:we({active:n.value===C}),onClick:S=>n.value=C},B(C),11,Et))),128))]),r("div",It,[n.value==="分析报告"?(N(),L("div",Rt)):se("",!0),n.value==="可视化图表"?(N(),L("div",$t,[fe(At,{"video-id":i.videoId},null,8,["video-id"])])):se("",!0)])]))}},Ot=ge(Tt,[["__scopeId","data-v-1aab0d50"]]),Lt={class:"video-panel"},Nt={class:"video-wrapper"},zt={class:"frame-panel"},Pt={class:"video-frame",style:{position:"relative"}},jt=["src"],qt={key:0,class:"loading-overlay"},Mt={class:"loading-text"},Ut={class:"options-panel"},Bt={key:0},Vt={key:0,class:"skeleton-controls"},Zt={class:"video-controls"},Ht=["max","disabled"],Kt={class:"time-display"},Wt={class:"navigation-buttons"},Yt=["disabled"],Xt=["disabled"],Qt={key:0,class:"debug-panel-title"},Jt={key:0,class:"debug-panel"},Gt={class:"instance-container"},es={class:"instance-header"},ts={class:"bbox-info"},ss={class:"data-value"},ns={class:"keypoint-table"},rs={__name:"FramePanel",props:{videoId:{type:String,required:!0}},setup(s){const n=ze(),u=s,i=H([]),o=H([]),h=H([]),C=H(!0),S=H(0),z=H(0),v=H(null),X=H(!1),P=H(!1),_=H(!1),Q=H(!0),te=H(!1),ne=H(!1),de=H(!1);let G=H(null);const pe=ke(()=>h.value.length),ve=ke(()=>z.value+1),De=ke(()=>h.value[z.value]||""),Se=ke(()=>{var d,l;if(!((l=(d=G.value)==null?void 0:d.instance_info)!=null&&l.length))return[];const x=G.value.instance_info.find(w=>w.frame_id===ve.value);return((x==null?void 0:x.instances)||[]).map(w=>{var m,j,O,K;const c=(w.keypoints||[]).map((q,b)=>{var A,$,g,I,M;return{name:(($=(A=G.value.meta_info)==null?void 0:A.keypoint_id2name)==null?void 0:$[b])||`点${b}`,x:((g=q[0])==null?void 0:g.toFixed(1))||"NaN",y:((I=q[1])==null?void 0:I.toFixed(1))||"NaN",score:((M=w.keypoint_scores)==null?void 0:M[b])||0}}),R=w.bbox||[],y=c.map(q=>q.score),k=y.length>0?y.reduce((q,b)=>q+b,0)/y.length:0;return{bbox:{x1:((m=R[0])==null?void 0:m.toFixed(1))||"NaN",y1:((j=R[1])==null?void 0:j.toFixed(1))||"NaN",x2:((O=R[2])==null?void 0:O.toFixed(1))||"NaN",y2:((K=R[3])==null?void 0:K.toFixed(1))||"NaN"},keypoints:c,avgConfidence:k}})}),ae=x=>({backgroundColor:`hsl(${x*120}, 70%, 40%)`,color:x>.6?"white":"#333"}),T=x=>({width:`${x*100}%`,backgroundColor:`hsl(${x*120}, 70%, 50%)`}),e=()=>{var x;!_.value||!((x=G.value)!=null&&x.instance_info)||Ve(async()=>{var w,c;const d=await t(),l=v.value;if(l.innerHTML="",!(!d||!l))try{const R=d.getBoundingClientRect(),{naturalWidth:y,naturalHeight:k}=d,m=R.width/y,j=R.height/k,O=(w=G.value.instance_info)==null?void 0:w.find(q=>q.frame_id===ve.value);if(!(O!=null&&O.instances))return;const K=((c=G.value.meta_info)==null?void 0:c.keypoint_id2name)||{};O.instances.forEach(q=>{if(te.value&&Array.isArray(q.bbox)&&q.bbox.length>=4){const[b,A,$,g]=q.bbox,I=document.createElement("div");I.className="bbox",Object.assign(I.style,{left:`${b*m}px`,top:`${A*j}px`,width:`${($-b)*m}px`,height:`${(g-A)*j}px`,display:te.value?"block":"none",position:"absolute"}),l.appendChild(I)}Q.value&&Array.isArray(q.keypoints)&&q.keypoints.forEach((b,A)=>{if(b.length<2)return;const[$,g]=b,I=document.createElement("div");if(I.className="keypoint",Object.assign(I.style,{left:`${$*m}px`,top:`${g*j}px`,display:Q.value?"block":"none",position:"absolute"}),l.appendChild(I),de.value){const M=document.createElement("div");M.className="keypoint-label",M.textContent=K[A]||`点${A}`,Object.assign(M.style,{left:`${$*m}px`,top:`${g*j}px`,transform:"translate(-50%, -100%)"}),l.appendChild(M)}})})}catch(R){console.error("渲染错误:",R)}})},t=()=>new Promise(x=>{const d=document.querySelector(".video-frame img");if(d.complete)return x(d);d.onload=()=>x(d)}),a=()=>z.value>0&&z.value--,p=()=>z.value<pe.value-1&&z.value++;me(P,async x=>{x&&o.value.length===0&&(o.value=await f(u.videoId,!0)),h.value=x?o.value:i.value}),me(_,x=>{x&&!G.value&&F(u.videoId)}),Me(async()=>{u.videoId&&(i.value=await f(u.videoId),h.value=i.value,C.value=!1)}),me(()=>u.videoId,async x=>{x&&(i.value=await f(x),h.value=i.value,o.value=[],G.value=null)});const f=async(x,d=!1)=>{const l=d?`/api/pose-frames/${x}`:`/api/frames-batch/${x}`;try{const w=await fetch(l,{headers:{Authorization:`Bearer ${n.token}`}}),{data:c}=await w.json();return(c==null?void 0:c.frames)||[]}catch(w){return console.error("加载失败:",w),[]}};async function F(x){var d,l;try{const c=await(await fetch(`/api/pose-data/${x}`,{headers:{Authorization:`Bearer ${n.token}`}})).json(),R={meta_info:{...c.data.meta_info,skeleton_links:((d=c.data.meta_info)==null?void 0:d.skeleton_links)||[],keypoint_colors:Array.isArray((l=c.data.meta_info)==null?void 0:l.keypoint_colors)?c.data.meta_info.keypoint_colors:[]},instance_info:(c.data.instance_info||[]).map(y=>({frame_id:Number(y.frame_id)||0,instances:(y.instances||[]).map(k=>({bbox:Array.isArray(k.bbox)?k.bbox.flat():[],keypoints:W(k.keypoints),keypoint_scores:Array.isArray(k.keypoint_scores)?k.keypoint_scores:[]}))}))};return G.value=R,R}catch(w){throw console.error("骨骼数据加载失败:",w),G.value={error:w.message},w}}function W(x){return Array.isArray(x)?x.map(d=>Array.isArray(d)?d.map(Number):[]):[]}return(x,d)=>(N(),L("div",Lt,[r("div",Nt,[r("div",zt,[d[13]||(d[13]=r("h2",null,"视频帧分析",-1)),r("div",Pt,[r("img",{src:De.value,alt:"",onLoad:e},null,40,jt),r("div",{ref_key:"skeletonOverlay",ref:v,class:"skeleton-overlay",style:{position:"absolute"}},null,512),C.value?(N(),L("div",qt,[r("div",Mt,"加载中... "+B(S.value)+"/"+B(pe.value),1)])):se("",!0)]),r("div",Ut,[r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[0]||(d[0]=l=>P.value=l)},null,512),[[xe,P.value]]),d[7]||(d[7]=be(" 添加骨骼点检测 "))]),r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[1]||(d[1]=l=>_.value=l)},null,512),[[xe,_.value]]),d[8]||(d[8]=be(" 添加坐标绘制 ")),X.value?(N(),L("span",Bt,"(加载中...)")):se("",!0)]),_.value?(N(),L("div",Vt,[r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[2]||(d[2]=l=>Q.value=l)},null,512),[[xe,Q.value]]),d[9]||(d[9]=be(" 显示骨骼点 "))]),r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[3]||(d[3]=l=>te.value=l)},null,512),[[xe,te.value]]),d[10]||(d[10]=be(" 显示边界框 "))]),r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[4]||(d[4]=l=>de.value=l)},null,512),[[xe,de.value]]),d[11]||(d[11]=be(" 显示关键点标签 "))]),r("label",null,[he(r("input",{type:"checkbox","onUpdate:modelValue":d[5]||(d[5]=l=>ne.value=l)},null,512),[[xe,ne.value]]),d[12]||(d[12]=be(" 显示调试信息 "))])])):se("",!0)]),r("div",Zt,[he(r("input",{type:"range","onUpdate:modelValue":d[6]||(d[6]=l=>z.value=l),min:0,max:pe.value-1,step:"1",disabled:C.value},null,8,Ht),[[Ue,z.value,void 0,{number:!0}]]),r("div",Kt,B(ve.value)+" / "+B(pe.value),1)]),r("div",Wt,[r("button",{onClick:a,disabled:z.value===0,class:"sync-button"},"上一帧",8,Yt),r("button",{onClick:p,disabled:z.value===pe.value-1,class:"sync-button"},"下一帧",8,Xt)]),fe(Ot,{"video-id":s.videoId},null,8,["video-id"])]),ne.value?(N(),L("div",Qt,[d[16]||(d[16]=r("h2",null,"调试面板",-1)),ne.value?(N(),L("div",Jt,[r("div",Gt,[(N(!0),L(Re,null,$e(Se.value,(l,w)=>(N(),L("div",{key:w,class:"instance-card"},[r("div",es,[r("h3",null,"实例 "+B(w+1),1),r("div",{class:"confidence-badge",style:Le(ae(l.avgConfidence))},B((l.avgConfidence*100).toFixed(0))+"% ",5)]),r("div",ts,[d[14]||(d[14]=r("span",{class:"data-label"},"边界框:",-1)),r("span",ss,"("+B(l.bbox.x1)+", "+B(l.bbox.y1)+") → ("+B(l.bbox.x2)+", "+B(l.bbox.y2)+")",1)]),r("table",ns,[d[15]||(d[15]=r("thead",null,[r("tr",null,[r("th",null,"关键点"),r("th",null,"X坐标"),r("th",null,"Y坐标"),r("th",null,"置信度")])],-1)),r("tbody",null,[(N(!0),L(Re,null,$e(l.keypoints,(c,R)=>(N(),L("tr",{key:R},[r("td",null,B(c.name),1),r("td",null,B(c.x),1),r("td",null,B(c.y),1),r("td",null,[r("span",{class:"confidence-bar",style:Le(T(c.score))},B((c.score*100).toFixed(0))+"% ",5)])]))),128))])])]))),128))])])):se("",!0)])):se("",!0)])]))}},as=ge(rs,[["__scopeId","data-v-423f000d"]]),is={props:{type:String,progress:Number,currentTime:Number,duration:Number,isZoomed:Boolean},methods:{formatTime(s){const n=new Date(0);return n.setSeconds(s||0),n.toISOString().slice(11,19)}}},os={class:"video-controls"},ls=["value"],ds={class:"time-display"};function us(s,n,u,i,o,h){var C;return N(),L("div",os,[r("button",{onClick:n[0]||(n[0]=S=>s.$emit("toggle-play"))},B((C=s.$parent.$refs[`${u.type}Video`])!=null&&C.paused?"▶":"⏸"),1),r("input",{type:"range",class:"progress-bar",value:u.progress,onInput:n[1]||(n[1]=S=>s.$emit("seek",S.target.value)),min:"0",max:"100",step:"0.1"},null,40,ls),r("span",ds,B(h.formatTime(u.currentTime))+" / "+B(h.formatTime(u.duration)),1),r("button",{onClick:n[2]||(n[2]=S=>s.$emit("toggle-zoom"))},B(u.isZoomed?"✕":"⛶"),1)])}const cs=ge(is,[["render",us],["__scopeId","data-v-092d2f97"]]),hs={components:{VideoControls:cs},props:{originalSrc:String,processedSrc:String},data(){return{isSyncing:!1,progress:{original:0,processed:0},currentTime:{original:0,processed:0},duration:{original:0,processed:0},isZoomed:{original:!1,processed:!1}}},mounted(){document.addEventListener("fullscreenchange",this.handleFullscreenChange)},beforeDestroy(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange)},methods:{togglePlay(s){const n=this.$refs[`${s}Video`];n.paused?n.play():n.pause()},updateProgress(s,n){const u=s.target;this.currentTime[n]=u.currentTime,this.duration[n]=u.duration,this.progress[n]=u.currentTime/u.duration*100||0,this.isSyncing&&n==="original"&&(this.$refs.processedVideo.currentTime=u.currentTime)},handleSeek(s,n){const u=this.$refs[`${n}Video`];u.currentTime=s*u.duration/100},toggleSync(){this.isSyncing=!this.isSyncing,this.isSyncing&&this.syncVideos()},async syncVideos(){await Promise.all([this.$refs.originalVideo.play(),this.$refs.processedVideo.play()])},handlePlay(){this.isSyncing&&this.syncVideos()},handlePause(){this.isSyncing&&(this.$refs.originalVideo.pause(),this.$refs.processedVideo.pause())},async toggleZoom(s){const n=this.$refs[`${s}Panel`];this.isZoomed[s]?(await this.exitFullscreen(),this.isZoomed={...this.isZoomed,[s]:!1}):(await this.enterFullscreen(n),this.isZoomed={...this.isZoomed,[s]:!0})},async enterFullscreen(s){if(s.requestFullscreen)return s.requestFullscreen();if(s.webkitRequestFullscreen)return s.webkitRequestFullscreen();if(s.msRequestFullscreen)return s.msRequestFullscreen();console.warn("Fullscreen API is not supported")},async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()},handleFullscreenChange(){document.fullscreenElement||(this.isZoomed={original:!1,processed:!1})}}},fs={class:"video-comparator"},ps={class:"global-controls"},ms={class:"comparison-container"},gs={class:"video-wrapper"},vs={class:"video-frame"},_s=["src"],ys={class:"video-wrapper"},bs={class:"video-frame"},xs=["src"];function ks(s,n,u,i,o,h){const C=Oe("video-controls");return N(),L("div",fs,[r("div",ps,[n[13]||(n[13]=r("h2",null,"视频分析（原视频 / 处理视频）",-1)),r("button",{class:"sync-button",onClick:n[0]||(n[0]=(...S)=>h.toggleSync&&h.toggleSync(...S))},B(o.isSyncing?"断开同步":"同步播放"),1)]),r("div",ms,[r("div",{class:we(["video-panel",{"fullscreen-mode":o.isZoomed.original}]),ref:"originalPanel"},[r("div",gs,[r("div",vs,[r("video",{ref:"originalVideo",src:u.originalSrc,onPlay:n[1]||(n[1]=S=>h.handlePlay("original")),onPause:n[2]||(n[2]=S=>h.handlePause("original")),onTimeupdate:n[3]||(n[3]=S=>h.updateProgress(S,"original"))},null,40,_s)]),fe(C,{type:"original",progress:o.progress.original,currentTime:o.currentTime.original,duration:o.duration.original,"is-zoomed":o.isZoomed.original,onTogglePlay:n[4]||(n[4]=S=>h.togglePlay("original")),onSeek:n[5]||(n[5]=S=>h.handleSeek(S,"original")),onToggleZoom:n[6]||(n[6]=S=>h.toggleZoom("original"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2),r("div",{class:we(["video-panel",{"fullscreen-mode":o.isZoomed.processed}]),ref:"processedPanel"},[r("div",ys,[r("div",bs,[r("video",{ref:"processedVideo",src:u.processedSrc,onPlay:n[7]||(n[7]=S=>h.handlePlay("processed")),onPause:n[8]||(n[8]=S=>h.handlePause("processed")),onTimeupdate:n[9]||(n[9]=S=>h.updateProgress(S,"processed"))},null,40,xs)]),fe(C,{type:"processed",progress:o.progress.processed,currentTime:o.currentTime.processed,duration:o.duration.processed,"is-zoomed":o.isZoomed.processed,onTogglePlay:n[10]||(n[10]=S=>h.togglePlay("processed")),onSeek:n[11]||(n[11]=S=>h.handleSeek(S,"processed")),onToggleZoom:n[12]||(n[12]=S=>h.toggleZoom("processed"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2)])])}const ws=ge(hs,[["render",ks],["__scopeId","data-v-60697c21"]]),Ss={class:"analysis-container"},Cs={class:"section-title"},As={class:"content-wrapper"},Ds={key:0,class:"loading"},Fs={key:1,class:"error"},Es={__name:"Analysis",setup(s){const n=He(),u=ze(),i=H(""),o=H(""),h=H(!1),C=H(null),S=H(null),z=ke(()=>n.historyItems.find(P=>P.id===n.currentAnalysisId)),v=ke(()=>z.value?new Date(z.value.time).toLocaleString():""),X=async P=>{var _,Q;try{h.value=!0;const te=u.token,ne=await Ne.get(`/api/video/${P}`,{headers:{Authorization:`Bearer ${te}`}});ne.data.success&&(i.value=ne.data.data.original,o.value=ne.data.data.processed||"")}catch(te){C.value=((Q=(_=te.response)==null?void 0:_.data)==null?void 0:Q.message)||"获取视频地址失败"}finally{h.value=!1}};return me(()=>{var P;return(P=z.value)==null?void 0:P.video_id},P=>{P&&X(P)},{immediate:!0}),me(()=>n.currentAnalysisId,P=>{const _=n.historyItems.find(Q=>Q.id===P);S.value=(_==null?void 0:_.video_id)||null},{immediate:!0}),me(S,P=>{P&&X(P)}),(P,_)=>(N(),L("div",Ss,[r("h2",Cs,"分析汇总界面 - "+B(v.value),1),r("div",As,[h.value?(N(),L("div",Ds,"加载中...")):se("",!0),C.value?(N(),L("div",Fs,B(C.value),1)):se("",!0),fe(ws,{"original-src":i.value,"processed-src":o.value},null,8,["original-src","processed-src"]),fe(as,{"video-id":z.value.video_id},null,8,["video-id"])])]))}},Ls=ge(Es,[["__scopeId","data-v-3a46043b"]]);export{Ls as default};
