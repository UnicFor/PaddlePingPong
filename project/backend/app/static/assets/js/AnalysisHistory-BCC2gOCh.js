import{u as C}from"./Main-CbR2Qn6A.js";import{_ as m}from"./Logo-DYSl22Km.js";import{c as d,o as l,a as s,t as h,n as _,j as f,f as g,b as v,w as D,v as w,F as M,r as $,p as L,e as z,l as k,m as T,C as I}from"./index-DGqoC7RW.js";import{L as H,i as S,f as x}from"./index-C91cXZ9t.js";import"./index-BtuGy7By.js";const E={props:{item:{type:Object,required:!0}},computed:{formattedTime(){return new Date(this.item.time).toLocaleString()},statusText(){return{processing:"分析中",completed:"已完成",expired:"已失效"}[this.item.status]},statusClass(){return`status-${this.item.status}`},isExpiringSoon(){const t=new Date(this.item.expiry);return Math.ceil((t-Date.now())/(1e3*3600*24))<=3},isCompleted(){return this.item.status==="completed"}},methods:{handleDelete(){confirm("确定要永久删除此报告？")&&this.$emit("delete",this.item.id)},handleCheck(){C().setCurrentAnalysisId(this.item.id),this.$emit("check")}},emits:["check","delete"]},P={class:"history-item"},R={class:"time-col"},A={class:"analysis-time"},F={class:"status-col"},B={class:"expiry-col"},O=["disabled"];function V(t,e,n,a,r,i){return l(),d("div",P,[s("div",R,[s("span",A,h(i.formattedTime),1)]),s("div",F,[s("span",{class:_(["status-badge",i.statusClass])},h(i.statusText),3)]),s("div",B,[s("span",{class:_(["expiry-indicator",{"expiring-soon":i.isExpiringSoon}])},h(n.item.expiry),3)]),s("div",null,[s("button",{class:_(["check-btn",{disabled:!i.isCompleted}]),disabled:!i.isCompleted,onClick:e[0]||(e[0]=(...o)=>i.handleCheck&&i.handleCheck(...o))}," 查看 ",10,O),s("button",{class:"delete-btn",onClick:e[1]||(e[1]=(...o)=>i.handleDelete&&i.handleDelete(...o))}," 删除 ")])])}const N=m(E,[["render",V],["__scopeId","data-v-ad9e8490"]]),Q={},Y={class:"virtual-header"};function G(t,e){return l(),d("div",Y,e[0]||(e[0]=[s("div",null,"分析时间",-1),s("div",null,"状态",-1),s("div",null,"有效期",-1),s("div",null,"操作",-1)]))}const U=m(Q,[["render",G],["__scopeId","data-v-a352623c"]]);function b(t=50,e=15){const n=1-Math.random(),a=Math.random(),r=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*a);return Math.min(100,Math.max(0,Math.round(r*e+t)))}const W={name:"ServerChart",props:{title:{type:String,default:"服务器负载趋势"}},data(){return{chart:null,dataPoints:[],baseline:50,stabilityCounter:0,currentTrend:0}},mounted(){this.initChart(),this.startSimulation(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){var t;window.removeEventListener("resize",this.handleResize),(t=this.chart)==null||t.dispose(),clearInterval(this.interval)},methods:{initChart(){this.chart=S(this.$refs.chart),this.setBaseOption()},generateSmartData(){this.stabilityCounter++>10&&(this.stabilityCounter=0,this.baseline=Math.min(80,Math.max(20,this.baseline+(Math.random()>.5?15:-15))),this.currentTrend=Math.random()>.5?1:-1);let t;this.stabilityCounter<3?t=this.currentTrend*(5+Math.random()*10):t=b(0,3);const e=Math.min(100,Math.max(0,this.baseline+t+b(0,2)));return Math.round(e)},startSimulation(){this.dataPoints=Array.from({length:30},()=>this.generateSmartData()),this.interval=setInterval(()=>{this.stabilityCounter++;const t=this.generateSmartData();this.dataPoints=[...this.dataPoints.slice(1),t],this.chart.setOption({xAxis:{data:this.generateTimeLabels()},series:[{data:this.dataPoints}]})},2e3)},setBaseOption(){const t={title:{top:10,left:"center",text:"当前服务器负载",textStyle:{fontSize:20,color:"#2d3748"}},tooltip:{trigger:"axis",backgroundColor:"#fff",borderColor:"#e4e7ed",borderWidth:1,textStyle:{color:"#606266"},axisPointer:{type:"line",lineStyle:{color:"#409EFF",type:"dashed"}}},grid:{left:"4%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:this.generateTimeLabels(),axisLine:{lineStyle:{color:"#dcdfe6"}},axisLabel:{color:"#909399"}},yAxis:{type:"value",max:100,axisLine:{show:!1},splitLine:{lineStyle:{color:"#ebeef5",type:"dashed"}},axisLabel:{color:"#909399",formatter:"{value}%"}},series:[{name:"CPU使用率",type:"line",smooth:!0,symbol:"none",areaStyle:{color:new H(0,0,0,1,[{offset:0,color:"#a0cfff"},{offset:1,color:"#ecf5ff"}])},lineStyle:{width:2,color:"#409EFF"},data:this.dataPoints}]};this.chart.setOption(t)},generateTimeLabels(){const t=new Date;return Array.from({length:30},(e,n)=>new Date(t.getTime()-(29-n)*2e3).toLocaleTimeString("zh",{hour12:!1}))}}},j={class:"chart-container"},q={ref:"chart",style:{width:"100%",height:"100%"}};function Z(t,e,n,a,r,i){return l(),d("div",j,[s("div",q,null,512)])}const J=m(W,[["render",Z],["__scopeId","data-v-3587c2d0"]]),K={props:{year:{type:Number,default:new Date().getFullYear()}},data(){return{myChart:null,chartData:[]}},mounted(){this.chartData=this.generateYearData(),this.$nextTick(()=>{this.initChart()}),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.disposeChart()},methods:{initChart(){if(this.disposeChart(),!this.$refs.chartContainer)return;this.myChart=S(this.$refs.chartContainer);const t={title:{top:10,left:"center",text:`${this.year} 提交记录`,textStyle:{fontSize:28,color:"#2d3748"}},tooltip:{formatter:e=>`${e.value[0]}<br/>提交次数: ${e.value[1]}`},visualMap:{min:0,max:20,type:"piecewise",orient:"horizontal",left:"center",top:60,pieces:[{min:0,max:0,color:"#f0f9ff"},{min:1,max:5,color:"#a0c8f0"},{min:6,max:10,color:"#63a4e3"},{min:11,max:20,color:"#3182ce"}],textStyle:{color:"#666"},selectedMode:!1},calendar:{top:120,left:"10%",right:"6%",cellSize:["auto",12],range:`${this.year}`,itemStyle:{borderWidth:.5,color:"#f8fafc"},dayLabel:{firstDay:1,fontSize:12,color:"#666",nameMap:["周日 ","周一 ","周二 ","周三 ","周四 ","周五 ","周六 "]},monthLabel:{nameMap:"ZH",color:"#666",fontSize:12,margin:8},splitLine:{lineStyle:{color:"#616161",width:.5}},yearLabel:{show:!1}},series:{type:"heatmap",coordinateSystem:"calendar",data:this.chartData,progressive:400,blurSize:8,itemStyle:{borderRadius:4},emphasis:{itemStyle:{borderColor:"#333",borderWidth:1}}}};t&&this.myChart.setOption(t)},disposeChart(){this.myChart&&(this.myChart.dispose(),this.myChart=null)},handleResize(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.myChart&&this.myChart.resize()},60)},generateYearData(){const t=[],e=new Date,n=+new Date(`${this.year}-01-01`),a=+new Date(`${this.year+1}-01-01`),r=3600*24*1e3;for(let o=n;o<a;o+=r)t.push([x(o,"{yyyy}-{MM}-{dd}",!1),0]);const i=this.year;for(let o=0;o<24;o++){const u=new Date(e);u.setDate(e.getDate()-o);const p=x(u,"{yyyy}-{MM}-{dd}",!1),y=t.findIndex(c=>c[0]===p);if(y!==-1){const c=Math.abs(Math.sin(i+o))*20;t[y][1]=Math.floor(c)}}return t}}},X={ref:"chartContainer",class:"commit-heatmap"};function tt(t,e,n,a,r,i){return l(),d("div",X,null,512)}const et=m(K,[["render",tt],["__scopeId","data-v-62185f9a"]]),st={components:{ServerGauge:J,CommitHeatmap:et,HistoryItem:N,HistoryHeader:U},data(){return{year:new Date().getFullYear()}},setup(){const t=C(),e=z("");t.fetchHistory();const n=k(()=>t.historyItems?t.historyItems.filter(r=>r.time.includes(e.value)||r.status.includes(e.value)).sort((r,i)=>i.id-r.id):[]),a=async r=>{await t.deleteItem(r)};return T(()=>{t.startAutoRefresh()}),I(()=>{clearTimeout(t.polling)}),{searchQuery:e,filteredItems:n,handleDelete:a,historyStore:t}}},at={class:"analysis-history"},it={class:"dashboard-container"},rt={class:"heatmap-section"},ot={class:"gauge-section"},nt={class:"search-filter"},lt={key:0,class:"loading"},dt={key:1},ct={class:"table-body"},ht={key:0,class:"nodata"},mt={key:2,class:"error-message"};function ut(t,e,n,a,r,i){const o=f("commit-heatmap"),u=f("server-gauge"),p=f("HistoryHeader"),y=f("HistoryItem");return l(),d("section",at,[e[2]||(e[2]=s("h2",{class:"section-title"},"分析详情",-1)),s("div",it,[s("div",rt,[v(o,{year:r.year},null,8,["year"])]),s("div",ot,[v(u,{title:"服务器负载监控"})])]),e[3]||(e[3]=s("h2",{class:"section-title"},"历史记录",-1)),s("div",nt,[D(s("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>a.searchQuery=c),type:"text",placeholder:"搜索历史记录（时间）"},null,512),[[w,a.searchQuery]])]),a.historyStore.isLoading?(l(),d("div",lt," 正在加载历史记录... ")):(l(),d("div",dt,[s("div",ct,[v(p),(l(!0),d(M,null,$(a.filteredItems,c=>(l(),L(y,{key:c.id,item:c,onDelete:a.handleDelete,onCheck:e[1]||(e[1]=yt=>t.$emit("check"))},null,8,["item","onDelete"]))),128)),a.filteredItems.length?g("",!0):(l(),d("div",ht,h(a.searchQuery?"无搜索结果":"暂无数据"),1))])])),a.historyStore.error?(l(),d("div",mt," 错误: "+h(a.historyStore.error),1)):g("",!0)])}const xt=m(st,[["render",ut],["__scopeId","data-v-da366dfa"]]);export{xt as default};
