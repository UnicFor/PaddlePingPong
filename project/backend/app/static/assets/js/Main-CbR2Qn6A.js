const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnalysisHistory-BCC2gOCh.js","assets/js/Logo-DYSl22Km.js","assets/js/index-DGqoC7RW.js","assets/css/index-D3nDvg0c.css","assets/css/Logo-LlBiUJ3O.css","assets/js/index-C91cXZ9t.js","assets/js/index-BtuGy7By.js","assets/css/AnalysisHistory-MoBL3Mc2.css","assets/js/TechnicalEvaluation-DTTZ3ecu.js","assets/js/MarkdownRenderer-BS-UK7gl.js","assets/css/MarkdownRenderer-xYS0VlbR.css","assets/css/TechnicalEvaluation-DnaAIPJk.css","assets/js/Analysis-DdpQq8rn.js","assets/css/Analysis-CSYdSmmB.css"])))=>i.map(i=>d[i]);
import{k as z,u as k,e as b,l as L,m as G,c as A,b as w,a as e,i as _,T as B,p as T,j as S,F as x,r as J,f as v,t as c,q as M,s as O,n as D,o as u,w as R,x as H,y as Y,z as P,A as U,B as j,_ as E}from"./index-DGqoC7RW.js";import{_ as F,l as q}from"./Logo-DYSl22Km.js";import{a as K}from"./index-BtuGy7By.js";const W=z("history",()=>{const o=k(),s=b([]),a=b(null),r=b(!1),t=b(null),l=b(!1),g=b(null),p=L(()=>s.value.filter(h=>h.status==="processing")),i=h=>{a.value=h},m=async()=>{var h;try{r.value=!0;const n=await fetch("/api/history",{headers:{Authorization:`Bearer ${o.token}`}});if(!n.ok){const{message:d}=await n.json();t.value=d||"获取历史记录失败";return}const{data:f}=await n.json();if(s.value=f.map(d=>({id:d.id,user_id:d.user_id,video_id:d.video_id,time:d.time,status:d.status,expiry:d.expiry})),!l.value){if(s.value.length>0){const d=[...s.value].filter(y=>y.status==="completed").sort((y,V)=>V.id-y.id);a.value=((h=d[0])==null?void 0:h.id)||null}l.value=!0}t.value=null}catch(n){t.value=n.message||"请求失败，请检查网络连接",console.error("获取历史记录失败:",n)}finally{r.value=!1,p.value.length>0&&(g.value=setTimeout(m,1e4))}};return{historyItems:s,currentAnalysisId:a,isLoading:r,error:t,setCurrentAnalysisId:i,fetchHistory:m,deleteItem:async h=>{try{const n=Number(h),f=await fetch(`/api/history/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${o.token}`}});if(!f.ok){let d="删除项目失败";try{d=(await f.json()).message||d}catch{d=`${f.status} ${f.statusText}`}t.value=d;return}s.value=s.value.filter(d=>d.id!==n),a.value===n&&(a.value=null),t.value=null}catch(n){t.value=n.message||"删除请求失败，请检查网络连接",console.error("删除操作失败:",n)}},polling:g,startAutoRefresh:()=>{p.value.length>0&&(g.value=setTimeout(m,1e4))},processingItems:p}}),X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA+0lEQVR42u3XPQrCMBiAYbtYf65QOqlFcXLwEko9h2dxcbC9gGBBT+EdBAdtpeAdFBw+3yFTB3+wJiIJPFDokJcmtE3Fjp8c9dbIhQe/JB5qr04eYIkT8pKckKD3bPIqlpAvSVB9FOAhhWCHCDEW2EKULRaIXxBhB0EK71GAjxyCuHBvClGmb+6pGIIcvg34rwCuHbTQhmMiYIA9UoQmAsa4QHBGqDuggTluhQg9AepeExFEOaKjO2AOUVIEOpdgVliCic49EOJanFxnwBAHZJiYehF1EMCx3wIb8GGA+V8yFyvIl6zhPntcXSTIkJckwwZ9owcTe+T7yXEHdqT/B3xAAB8AAAAASUVORK5CYII=",N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA/klEQVR42u3XsQqCQByA8aYssrEmcQqiaOo1gmrsFXqSIAgayhcIkuopeoKW1gqhraXWGv59w003WIGeEnfwA/GG+1BRr2BHLke50XPgwU+Ih9K3izexwgVRQi4I0f60eBErSEpCFOMCPJwgOGKJAAvsIcoeCwRfWOIIwQleXICPCIJAmxtDlPGPz1QAQQTfBvxvAOfL6KJmPIBzLia4YwPXWIBafIoXBAfUjARwXNEWv2Kgpo0EjPCE4IahmsosYGA6wMVcuwV9QwF6hPmHUI+Y4YEdqlm+iOr2W2AD4gJy/UvmYA1JyRbOp8vVQogzooScsUMn042J3fLlcrwBYJz+9JWY1lwAAAAASUVORK5CYII=",Q="/assets/png/default-avatar-DbLJzQkT.png",Z={components:{logo:q},props:{activeTab:{type:String,required:!0},isCollapsed:{type:Boolean,default:!1}},data(){return{showUploadDialog:!1,selectedFile:null,uploadProgress:0,uploadStatus:null,tabs:[{id:"analysis-view",label:"分析界面"},{id:"analysis-history",label:"分析历史"},{id:"technical-evaluation",label:"技术问答"}]}},methods:{goHome(){this.$router.push("/")},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(o){const s=o.target.files[0];if(!s)return;if(!["video/mp4","video/quicktime","video/x-msvideo"].includes(s.type)){alert("仅支持 MP4、MOV 和 AVI 格式的视频");return}if(s.size>1024*1024*1024){alert("文件大小不能超过1G");return}this.selectedFile=s,this.showUploadDialog=!0,this.uploadStatus=null,this.uploadProgress=0},performUpload(){const o=new FormData;o.append("video",this.selectedFile);const s={headers:{Authorization:`Bearer ${this.authStore.token}`}};this.uploadStatus="uploading",K.post("/api/upload",o,s).then(a=>{this.uploadStatus="success",this.historyStore.fetchHistory(),setTimeout(()=>{this.closeUploadDialog(),this.$emit("video-uploaded",a.data)},1500)}).catch(a=>{this.uploadStatus="error",console.error("上传失败:",a)})},closeUploadDialog(){this.showUploadDialog=!1,this.selectedFile=null,this.uploadProgress=0,this.uploadStatus=null},handleTabClick(o){o.id==="analysis-view"&&!this.hasHistory||this.$emit("switch-tab",o.id)}},setup(){const o=k(),s=W();G(()=>{o.isLoggedIn&&!o.userInfo&&o.fetchUserInfo()});const a=L(()=>{var r;return((r=s.historyItems)==null?void 0:r.length)>0});return{authStore:o,historyStore:s,hasHistory:a}}},$={class:"logo"},ee={class:"sidebar-header"},se={class:"control-buttons"},te={class:"sidebar-nav"},oe=["onClick"],le={key:0,class:"upload-modal"},ie={class:"modal-content"},ae={class:"file-info"},ne={key:0,class:"progress-bar"},re={class:"progress-text"},de={key:1,class:"status-success"},ue={key:2,class:"status-error"},ce={class:"modal-actions"},pe=["disabled"],he={class:"username"};function Ae(o,s,a,r,t,l){var p;const g=S("logo");return u(),A(x,null,[w(B,{name:"button-fade"},{default:_(()=>[a.isCollapsed?(u(),A("button",{key:0,class:"expand-btn",onClick:s[0]||(s[0]=i=>o.$emit("toggle-collapse"))},s[8]||(s[8]=[e("img",{src:X,alt:"打开侧栏"},null,-1)]))):v("",!0)]),_:1}),e("nav",{class:D(["user-sidebar",{collapsed:a.isCollapsed}])},[e("h3",$,[w(g)]),e("button",{class:"collapse-btn",onClick:s[1]||(s[1]=i=>o.$emit("toggle-collapse"))},s[9]||(s[9]=[e("img",{src:N,alt:"收起侧栏"},null,-1)])),e("div",ee,[e("div",se,[e("input",{type:"file",ref:"fileInput",hidden:"",accept:"video/mp4,video/quicktime,video/x-msvideo",onChange:s[2]||(s[2]=(...i)=>l.handleFileSelect&&l.handleFileSelect(...i))},null,544),e("button",{class:"nav-item",onClick:s[3]||(s[3]=(...i)=>l.triggerFileInput&&l.triggerFileInput(...i))},s[10]||(s[10]=[e("span",null,"上传视频",-1)])),e("button",{class:"nav-item",onClick:s[4]||(s[4]=(...i)=>l.goHome&&l.goHome(...i))},s[11]||(s[11]=[e("span",null,"返回首页",-1)]))]),s[12]||(s[12]=e("hr",null,null,-1))]),e("ul",te,[(u(!0),A(x,null,J(t.tabs,i=>(u(),A("li",{key:i.id,class:D(["nav-item",{active:a.activeTab===i.id,disabled:i.id==="analysis-view"&&!r.hasHistory}]),onClick:m=>l.handleTabClick(i)},[e("span",null,c(i.label),1)],10,oe))),128))]),(u(),T(O,{to:"body"},[t.showUploadDialog?(u(),A("div",le,[e("div",ie,[s[13]||(s[13]=e("h3",null,"确认上传视频",-1)),e("div",ae,[e("p",null,"文件名: "+c(t.selectedFile.name),1),e("p",null,"文件类型: "+c(t.selectedFile.type),1),e("p",null,"文件大小: "+c((t.selectedFile.size/1024/1024).toFixed(2))+"MB",1)]),t.uploadStatus==="uploading"?(u(),A("div",ne,[e("div",{class:"progress-fill",style:M({width:t.uploadProgress+"%"})},null,4),e("span",re,c(t.uploadProgress)+"%",1)])):v("",!0),t.uploadStatus==="success"?(u(),A("div",de," 上传成功 ")):v("",!0),t.uploadStatus==="error"?(u(),A("div",ue," 上传失败，请重试 ")):v("",!0),e("div",ce,[t.uploadStatus?v("",!0):(u(),A("button",{key:0,class:"confirm-btn",onClick:s[5]||(s[5]=(...i)=>l.performUpload&&l.performUpload(...i))}," 确认上传 ")),e("button",{class:"cancel-btn",onClick:s[6]||(s[6]=(...i)=>l.closeUploadDialog&&l.closeUploadDialog(...i)),disabled:t.uploadStatus==="uploading"},c(t.uploadStatus==="uploading"?"上传中...":"取消"),9,pe)])])])):v("",!0)])),e("div",{class:"user-entry",onClick:s[7]||(s[7]=i=>o.$emit("toggle-user-panel"))},[s[14]||(s[14]=e("div",{class:"user-avatar"},[e("img",{src:Q,alt:"用户"})],-1)),e("span",he,c(((p=r.authStore.userInfo)==null?void 0:p.username)??"加载中..."),1)])],2)],64)}const ge=F(Z,[["render",Ae],["__scopeId","data-v-53014787"]]),me={props:{show:{type:Boolean,default:!1},userInfo:{type:Object,default:()=>({name:"未命名",days:10,mobile:"未绑定",wechatBound:!1})}},emits:["close"],methods:{handleClose(){this.$emit("close")},handleBind(o){console.log(`绑定${o}`)},async handleLogout(){confirm("确定要退出登录吗？退出后将清除本机登录记录")&&(await this.$router.push("/login"),this.authStore.logout(),this.handleClose())}},setup(){return{authStore:k()}}},ve={key:0,class:"user-panel-wrapper"},fe={class:"user-panel"},be={class:"user-header"},we={class:"user-meta"},ye={class:"settings-container"},Ce={class:"settings-group"},Ie={class:"setting-item"},Se={class:"action"},ke={class:"status"},_e={class:"setting-item"},Be={class:"action"},Te={class:"status"},Pe={class:"action-buttons"};function Ue(o,s,a,r,t,l){return u(),T(O,{to:"body"},[w(B,{name:"panel-slide"},{default:_(()=>{var g,p,i,m,C,I,h;return[a.show?(u(),A("div",ve,[e("div",fe,[e("div",{class:"panel-close",onClick:s[0]||(s[0]=(...n)=>l.handleClose&&l.handleClose(...n))},s[4]||(s[4]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),e("div",be,[s[5]||(s[5]=e("div",{class:"avatar"},[e("img",{src:Q,alt:"avatar"})],-1)),e("div",we,[e("h3",null,c(((g=r.authStore.userInfo)==null?void 0:g.username)??"加载中..."),1),e("p",null,"与 Paddle PingPong 共度 "+c(((p=r.authStore.userInfo)==null?void 0:p.days)??"n")+" 天",1)])]),e("div",ye,[e("section",Ce,[s[8]||(s[8]=e("h4",{class:"group-title"},"账号设置",-1)),e("div",Ie,[s[6]||(s[6]=e("span",null,"手机号",-1)),e("div",Se,[e("span",ke,c((i=r.authStore.userInfo)!=null&&i.phone?(m=r.authStore.userInfo)==null?void 0:m.phone:"未绑定"),1),e("button",{class:"bind-btn",onClick:s[1]||(s[1]=n=>l.handleBind("mobile"))},"绑定")])]),e("div",_e,[s[7]||(s[7]=e("span",null,"微信账号",-1)),e("div",Be,[e("span",Te,c((C=r.authStore.userInfo)!=null&&C.weixin?(I=r.authStore.userInfo)==null?void 0:I.weixin:"未绑定"),1),e("button",{class:"bind-btn",onClick:s[2]||(s[2]=n=>l.handleBind("wechat"))},c((h=r.authStore.userInfo)!=null&&h.weixin?"解绑":"绑定"),1)])])]),s[10]||(s[10]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"帮助与反馈"),e("div",{class:"setting-item link-item"},[e("span",null,"使用帮助"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"意见反馈"),e("span",{class:"arrow"},"›")])],-1)),s[11]||(s[11]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"关于 Paddle PingPong"),e("div",{class:"setting-item link-item"},[e("span",null,"服务协议"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"隐私协议"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"开源条款"),e("span",{class:"arrow"},"›")])],-1)),s[12]||(s[12]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"百度飞浆大模型版本"),e("div",{class:"setting-item"},[e("span",null,"当前版本"),e("span",{class:"version"},"v3.0")]),e("div",{class:"setting-item link-item"},[e("span",null,"模型介绍"),e("span",{class:"arrow"},"›")])],-1)),e("div",Pe,[e("button",{class:"logout-btn",onClick:s[3]||(s[3]=(...n)=>l.handleLogout&&l.handleLogout(...n))},"退出登录"),s[9]||(s[9]=e("button",{class:"delete-account"},"注销账号",-1))])])])])):v("",!0)]}),_:1})])}const Ee=F(me,[["render",Ue],["__scopeId","data-v-0b465589"]]),Fe=P(U(()=>E(()=>import("./AnalysisHistory-BCC2gOCh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])))),xe=P(U(()=>E(()=>import("./TechnicalEvaluation-DTTZ3ecu.js"),__vite__mapDeps([8,9,1,2,3,4,10,6,11])))),De=P(U({loader:()=>E(()=>import("./Analysis-DdpQq8rn.js").then(o=>o.A),__vite__mapDeps([12,2,3,5,6,1,4,9,10,13])),delay:200})),Le={components:{SidebarNav:ge,UserPanel:Ee},data(){return{isMobile:!1,activeTab:"analysis-history",showUserPanel:!1,isSidebarCollapsed:!1,componentsMap:Y({"analysis-history":Fe,"technical-evaluation":xe,"analysis-view":De})}},computed:{activeComponent(){return this.componentsMap[this.activeTab]},sidebarWidth(){return this.isMobile?"0":this.isSidebarCollapsed?"20px":"240px"}},mounted(){this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkIsMobile)},methods:{switchTab(o){this.activeTab=o},switchToAnalysisView(){this.activeTab="analysis-view"},toggleUserPanel(){this.showUserPanel=!this.showUserPanel},handleLogout(){localStorage.removeItem("mockAuth"),localStorage.removeItem("mockUser"),this.$router.push("/login")},checkIsMobile(){this.isMobile=window.innerWidth<=768,this.isMobile&&!this.isSidebarCollapsed&&(this.isSidebarCollapsed=!0)}}},Me={class:"user-container"};function Oe(o,s,a,r,t,l){const g=S("SidebarNav"),p=S("UserPanel");return u(),A("div",Me,[w(g,{"active-tab":t.activeTab,"is-collapsed":t.isSidebarCollapsed,onSwitchTab:l.switchTab,onToggleUserPanel:l.toggleUserPanel,onToggleCollapse:s[0]||(s[0]=i=>t.isSidebarCollapsed=!t.isSidebarCollapsed)},null,8,["active-tab","is-collapsed","onSwitchTab","onToggleUserPanel"]),e("main",{class:"user-main",style:M({marginLeft:l.sidebarWidth})},[w(B,{name:"fade-slide",mode:"out-in"},{default:_(()=>[(u(),T(j(l.activeComponent),{onCheck:l.switchToAnalysisView},null,40,["onCheck"]))]),_:1}),w(p,{show:t.showUserPanel,"user-info":o.currentUser,onClose:l.toggleUserPanel,onLogout:l.handleLogout},null,8,["show","user-info","onClose","onLogout"])],4),R(e("div",{class:"sidebar-mask",onClick:s[1]||(s[1]=i=>t.isSidebarCollapsed=!0)},null,512),[[H,t.isMobile&&!t.isSidebarCollapsed]])])}const Qe=F(Le,[["render",Oe],["__scopeId","data-v-39f3f592"]]),Je=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"}));export{Je as M,W as u};
