const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/AnalysisHistory-DefyVx9L.js","assets/js/Logo-BALHfFiO.js","assets/js/index-DJYitv_v.js","assets/css/index-D3nDvg0c.css","assets/css/Logo-LlBiUJ3O.css","assets/js/index-C91cXZ9t.js","assets/js/index-BtuGy7By.js","assets/css/AnalysisHistory--4rUEfUP.css","assets/js/TechnicalEvaluation-BMPB8N6H.js","assets/js/MarkdownRenderer-DLouW1eD.js","assets/css/MarkdownRenderer-xYS0VlbR.css","assets/css/TechnicalEvaluation-OLq1PKuJ.css","assets/js/Analysis-tk-uJ-Bu.js","assets/css/Analysis-BSl4AfnM.css"])))=>i.map(i=>d[i]);
import{k as M,u as C,e as w,l as O,m as Q,c as h,b,a as e,i as I,T as S,p as k,j as y,F as U,r as V,f,t as c,q as F,s as x,n as E,o as u,w as z,x as G,y as J,z as _,A as B,B as H,_ as T}from"./index-DJYitv_v.js";import{_ as P,l as R}from"./Logo-BALHfFiO.js";import{a as Y}from"./index-BtuGy7By.js";const j=M("history",()=>{const o=C(),s=w([]),n=w(null),r=w(!1),t=w(null),l=w(!1);return{historyItems:s,currentAnalysisId:n,isLoading:r,error:t,setCurrentAnalysisId:A=>{n.value=A},fetchHistory:async()=>{var A;try{r.value=!0;const d=await fetch("/api/history",{headers:{Authorization:`Bearer ${o.token}`}});if(!d.ok){const{message:a}=await d.json();t.value=a||"获取历史记录失败";return}const{data:g}=await d.json();if(s.value=g.map(a=>({id:a.id,user_id:a.user_id,video_id:a.video_id,time:a.time,status:a.status,expiry:a.expiry})),!l.value){if(s.value.length>0){const a=[...s.value].filter(p=>p.status==="completed").sort((p,L)=>L.id-p.id);n.value=((A=a[0])==null?void 0:A.id)||null}l.value=!0}t.value=null}catch(d){t.value=d.message||"请求失败，请检查网络连接",console.error("获取历史记录失败:",d)}finally{r.value=!1}},deleteItem:async A=>{try{const d=Number(A),g=await fetch(`/api/history/${d}`,{method:"DELETE",headers:{Authorization:`Bearer ${o.token}`}});if(!g.ok){let a="删除项目失败";try{a=(await g.json()).message||a}catch{a=`${g.status} ${g.statusText}`}t.value=a;return}s.value=s.value.filter(a=>a.id!==d),n.value===d&&(n.value=null),t.value=null}catch(d){t.value=d.message||"删除请求失败，请检查网络连接",console.error("删除操作失败:",d)}}}}),q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA+0lEQVR42u3XPQrCMBiAYbtYf65QOqlFcXLwEko9h2dxcbC9gGBBT+EdBAdtpeAdFBw+3yFTB3+wJiIJPFDokJcmtE3Fjp8c9dbIhQe/JB5qr04eYIkT8pKckKD3bPIqlpAvSVB9FOAhhWCHCDEW2EKULRaIXxBhB0EK71GAjxyCuHBvClGmb+6pGIIcvg34rwCuHbTQhmMiYIA9UoQmAsa4QHBGqDuggTluhQg9AepeExFEOaKjO2AOUVIEOpdgVliCic49EOJanFxnwBAHZJiYehF1EMCx3wIb8GGA+V8yFyvIl6zhPntcXSTIkJckwwZ9owcTe+T7yXEHdqT/B3xAAB8AAAAASUVORK5CYII=",K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAA/klEQVR42u3XsQqCQByA8aYssrEmcQqiaOo1gmrsFXqSIAgayhcIkuopeoKW1gqhraXWGv59w003WIGeEnfwA/GG+1BRr2BHLke50XPgwU+Ih9K3izexwgVRQi4I0f60eBErSEpCFOMCPJwgOGKJAAvsIcoeCwRfWOIIwQleXICPCIJAmxtDlPGPz1QAQQTfBvxvAOfL6KJmPIBzLia4YwPXWIBafIoXBAfUjARwXNEWv2Kgpo0EjPCE4IahmsosYGA6wMVcuwV9QwF6hPmHUI+Y4YEdqlm+iOr2W2AD4gJy/UvmYA1JyRbOp8vVQogzooScsUMn042J3fLlcrwBYJz+9JWY1lwAAAAASUVORK5CYII=",D="/assets/png/default-avatar-DbLJzQkT.png",W={components:{logo:R},props:{activeTab:{type:String,required:!0},isCollapsed:{type:Boolean,default:!1}},data(){return{showUploadDialog:!1,selectedFile:null,uploadProgress:0,uploadStatus:null,tabs:[{id:"analysis-view",label:"分析界面"},{id:"analysis-history",label:"分析历史"},{id:"technical-evaluation",label:"技术问答"}]}},methods:{goHome(){this.$router.push("/")},triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(o){const s=o.target.files[0];if(!s)return;if(!["video/mp4","video/quicktime","video/x-msvideo"].includes(s.type)){alert("仅支持 MP4、MOV 和 AVI 格式的视频");return}if(s.size>1024*1024*1024){alert("文件大小不能超过1G");return}this.selectedFile=s,this.showUploadDialog=!0,this.uploadStatus=null,this.uploadProgress=0},performUpload(){const o=new FormData;o.append("video",this.selectedFile);const s={headers:{Authorization:`Bearer ${this.authStore.token}`}};this.uploadStatus="uploading",Y.post("/api/upload",o,s).then(n=>{this.uploadStatus="success",this.historyStore.fetchHistory(),setTimeout(()=>{this.closeUploadDialog(),this.$emit("video-uploaded",n.data)},1500)}).catch(n=>{this.uploadStatus="error",console.error("上传失败:",n)})},closeUploadDialog(){this.showUploadDialog=!1,this.selectedFile=null,this.uploadProgress=0,this.uploadStatus=null},handleTabClick(o){o.id==="analysis-view"&&!this.hasHistory||this.$emit("switch-tab",o.id)}},setup(){const o=C(),s=j();O(()=>{o.isLoggedIn&&!o.userInfo&&o.fetchUserInfo()});const n=Q(()=>{var r;return((r=s.historyItems)==null?void 0:r.length)>0});return{authStore:o,historyStore:s,hasHistory:n}}},X={class:"logo"},N={class:"sidebar-header"},Z={class:"control-buttons"},$={class:"sidebar-nav"},ee=["onClick"],se={key:0,class:"upload-modal"},te={class:"modal-content"},oe={class:"file-info"},le={key:0,class:"progress-bar"},ie={class:"progress-text"},ae={key:1,class:"status-success"},ne={key:2,class:"status-error"},re={class:"modal-actions"},de=["disabled"],ue={class:"username"};function ce(o,s,n,r,t,l){var m;const v=y("logo");return u(),h(U,null,[b(S,{name:"button-fade"},{default:I(()=>[n.isCollapsed?(u(),h("button",{key:0,class:"expand-btn",onClick:s[0]||(s[0]=i=>o.$emit("toggle-collapse"))},s[8]||(s[8]=[e("img",{src:q,alt:"打开侧栏"},null,-1)]))):f("",!0)]),_:1}),e("nav",{class:E(["user-sidebar",{collapsed:n.isCollapsed}])},[e("h3",X,[b(v)]),e("button",{class:"collapse-btn",onClick:s[1]||(s[1]=i=>o.$emit("toggle-collapse"))},s[9]||(s[9]=[e("img",{src:K,alt:"收起侧栏"},null,-1)])),e("div",N,[e("div",Z,[e("input",{type:"file",ref:"fileInput",hidden:"",accept:"video/mp4,video/quicktime,video/x-msvideo",onChange:s[2]||(s[2]=(...i)=>l.handleFileSelect&&l.handleFileSelect(...i))},null,544),e("button",{class:"nav-item",onClick:s[3]||(s[3]=(...i)=>l.triggerFileInput&&l.triggerFileInput(...i))},s[10]||(s[10]=[e("span",null,"上传视频",-1)])),e("button",{class:"nav-item",onClick:s[4]||(s[4]=(...i)=>l.goHome&&l.goHome(...i))},s[11]||(s[11]=[e("span",null,"返回首页",-1)]))]),s[12]||(s[12]=e("hr",null,null,-1))]),e("ul",$,[(u(!0),h(U,null,V(t.tabs,i=>(u(),h("li",{key:i.id,class:E(["nav-item",{active:n.activeTab===i.id,disabled:i.id==="analysis-view"&&!r.hasHistory}]),onClick:A=>l.handleTabClick(i)},[e("span",null,c(i.label),1)],10,ee))),128))]),(u(),k(x,{to:"body"},[t.showUploadDialog?(u(),h("div",se,[e("div",te,[s[13]||(s[13]=e("h3",null,"确认上传视频",-1)),e("div",oe,[e("p",null,"文件名: "+c(t.selectedFile.name),1),e("p",null,"文件类型: "+c(t.selectedFile.type),1),e("p",null,"文件大小: "+c((t.selectedFile.size/1024/1024).toFixed(2))+"MB",1)]),t.uploadStatus==="uploading"?(u(),h("div",le,[e("div",{class:"progress-fill",style:F({width:t.uploadProgress+"%"})},null,4),e("span",ie,c(t.uploadProgress)+"%",1)])):f("",!0),t.uploadStatus==="success"?(u(),h("div",ae," 上传成功 ")):f("",!0),t.uploadStatus==="error"?(u(),h("div",ne," 上传失败，请重试 ")):f("",!0),e("div",re,[t.uploadStatus?f("",!0):(u(),h("button",{key:0,class:"confirm-btn",onClick:s[5]||(s[5]=(...i)=>l.performUpload&&l.performUpload(...i))}," 确认上传 ")),e("button",{class:"cancel-btn",onClick:s[6]||(s[6]=(...i)=>l.closeUploadDialog&&l.closeUploadDialog(...i)),disabled:t.uploadStatus==="uploading"},c(t.uploadStatus==="uploading"?"上传中...":"取消"),9,de)])])])):f("",!0)])),e("div",{class:"user-entry",onClick:s[7]||(s[7]=i=>o.$emit("toggle-user-panel"))},[s[14]||(s[14]=e("div",{class:"user-avatar"},[e("img",{src:D,alt:"用户"})],-1)),e("span",ue,c(((m=r.authStore.userInfo)==null?void 0:m.username)??"加载中..."),1)])],2)],64)}const pe=P(W,[["render",ce],["__scopeId","data-v-53014787"]]),he={props:{show:{type:Boolean,default:!1},userInfo:{type:Object,default:()=>({name:"未命名",days:10,mobile:"未绑定",wechatBound:!1})}},emits:["close"],methods:{handleClose(){this.$emit("close")},handleBind(o){console.log(`绑定${o}`)},async handleLogout(){confirm("确定要退出登录吗？退出后将清除本机登录记录")&&(await this.$router.push("/login"),this.authStore.logout(),this.handleClose())}},setup(){return{authStore:C()}}},Ae={key:0,class:"user-panel-wrapper"},ge={class:"user-panel"},me={class:"user-header"},ve={class:"user-meta"},fe={class:"settings-container"},be={class:"settings-group"},we={class:"setting-item"},ye={class:"action"},Ce={class:"status"},Ie={class:"setting-item"},Se={class:"action"},ke={class:"status"},_e={class:"action-buttons"};function Be(o,s,n,r,t,l){return u(),k(x,{to:"body"},[b(S,{name:"panel-slide"},{default:I(()=>{var v,m,i,A,d,g,a;return[n.show?(u(),h("div",Ae,[e("div",ge,[e("div",{class:"panel-close",onClick:s[0]||(s[0]=(...p)=>l.handleClose&&l.handleClose(...p))},s[4]||(s[4]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),e("div",me,[s[5]||(s[5]=e("div",{class:"avatar"},[e("img",{src:D,alt:"avatar"})],-1)),e("div",ve,[e("h3",null,c(((v=r.authStore.userInfo)==null?void 0:v.username)??"加载中..."),1),e("p",null,"与 Paddle PingPong 共度 "+c(((m=r.authStore.userInfo)==null?void 0:m.days)??"n")+" 天",1)])]),e("div",fe,[e("section",be,[s[8]||(s[8]=e("h4",{class:"group-title"},"账号设置",-1)),e("div",we,[s[6]||(s[6]=e("span",null,"手机号",-1)),e("div",ye,[e("span",Ce,c((i=r.authStore.userInfo)!=null&&i.phone?(A=r.authStore.userInfo)==null?void 0:A.phone:"未绑定"),1),e("button",{class:"bind-btn",onClick:s[1]||(s[1]=p=>l.handleBind("mobile"))},"绑定")])]),e("div",Ie,[s[7]||(s[7]=e("span",null,"微信账号",-1)),e("div",Se,[e("span",ke,c((d=r.authStore.userInfo)!=null&&d.weixin?(g=r.authStore.userInfo)==null?void 0:g.weixin:"未绑定"),1),e("button",{class:"bind-btn",onClick:s[2]||(s[2]=p=>l.handleBind("wechat"))},c((a=r.authStore.userInfo)!=null&&a.weixin?"解绑":"绑定"),1)])])]),s[10]||(s[10]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"帮助与反馈"),e("div",{class:"setting-item link-item"},[e("span",null,"使用帮助"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"意见反馈"),e("span",{class:"arrow"},"›")])],-1)),s[11]||(s[11]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"关于 Paddle PingPong"),e("div",{class:"setting-item link-item"},[e("span",null,"服务协议"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"隐私协议"),e("span",{class:"arrow"},"›")]),e("div",{class:"setting-item link-item"},[e("span",null,"开源条款"),e("span",{class:"arrow"},"›")])],-1)),s[12]||(s[12]=e("section",{class:"settings-group"},[e("h4",{class:"group-title"},"百度飞浆大模型版本"),e("div",{class:"setting-item"},[e("span",null,"当前版本"),e("span",{class:"version"},"v3.0")]),e("div",{class:"setting-item link-item"},[e("span",null,"模型介绍"),e("span",{class:"arrow"},"›")])],-1)),e("div",_e,[e("button",{class:"logout-btn",onClick:s[3]||(s[3]=(...p)=>l.handleLogout&&l.handleLogout(...p))},"退出登录"),s[9]||(s[9]=e("button",{class:"delete-account"},"注销账号",-1))])])])])):f("",!0)]}),_:1})])}const Te=P(he,[["render",Be],["__scopeId","data-v-0b465589"]]),Pe=_(B(()=>T(()=>import("./AnalysisHistory-DefyVx9L.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])))),Ue=_(B(()=>T(()=>import("./TechnicalEvaluation-BMPB8N6H.js"),__vite__mapDeps([8,9,1,2,3,4,10,6,11])))),Ee=_(B({loader:()=>T(()=>import("./Analysis-tk-uJ-Bu.js").then(o=>o.A),__vite__mapDeps([12,2,3,5,6,1,4,9,10,13])),delay:200})),Fe={components:{SidebarNav:pe,UserPanel:Te},data(){return{isMobile:!1,activeTab:"analysis-history",showUserPanel:!1,isSidebarCollapsed:!1,componentsMap:J({"analysis-history":Pe,"technical-evaluation":Ue,"analysis-view":Ee})}},computed:{activeComponent(){return this.componentsMap[this.activeTab]},sidebarWidth(){return this.isMobile?"0":this.isSidebarCollapsed?"20px":"240px"}},mounted(){this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeUnmount(){window.removeEventListener("resize",this.checkIsMobile)},methods:{switchTab(o){this.activeTab=o},switchToAnalysisView(){this.activeTab="analysis-view"},toggleUserPanel(){this.showUserPanel=!this.showUserPanel},handleLogout(){localStorage.removeItem("mockAuth"),localStorage.removeItem("mockUser"),this.$router.push("/login")},checkIsMobile(){this.isMobile=window.innerWidth<=768,this.isMobile&&!this.isSidebarCollapsed&&(this.isSidebarCollapsed=!0)}}},xe={class:"user-container"};function De(o,s,n,r,t,l){const v=y("SidebarNav"),m=y("UserPanel");return u(),h("div",xe,[b(v,{"active-tab":t.activeTab,"is-collapsed":t.isSidebarCollapsed,onSwitchTab:l.switchTab,onToggleUserPanel:l.toggleUserPanel,onToggleCollapse:s[0]||(s[0]=i=>t.isSidebarCollapsed=!t.isSidebarCollapsed)},null,8,["active-tab","is-collapsed","onSwitchTab","onToggleUserPanel"]),e("main",{class:"user-main",style:F({marginLeft:l.sidebarWidth})},[b(S,{name:"fade-slide",mode:"out-in"},{default:I(()=>[(u(),k(H(l.activeComponent),{onCheck:l.switchToAnalysisView},null,40,["onCheck"]))]),_:1}),b(m,{show:t.showUserPanel,"user-info":o.currentUser,onClose:l.toggleUserPanel,onLogout:l.handleLogout},null,8,["show","user-info","onClose","onLogout"])],4),z(e("div",{class:"sidebar-mask",onClick:s[1]||(s[1]=i=>t.isSidebarCollapsed=!0)},null,512),[[G,t.isMobile&&!t.isSidebarCollapsed]])])}const Le=P(Fe,[["render",De],["__scopeId","data-v-39f3f592"]]),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Ve as M,j as u};
