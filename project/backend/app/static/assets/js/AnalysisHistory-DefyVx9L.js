import{u as C}from"./Main-Cg00K4da.js";import{_ as m}from"./Logo-BALHfFiO.js";import{c as d,o as l,a as s,t as h,n as _,j as f,f as x,b as v,w as D,v as w,F as M,r as $,p as L,e as z,m as k}from"./index-DJYitv_v.js";import{L as I,i as S,f as b}from"./index-C91cXZ9t.js";import"./index-BtuGy7By.js";const T={props:{item:{type:Object,required:!0}},computed:{formattedTime(){return new Date(this.item.time).toLocaleString()},statusText(){return{processing:"分析中",completed:"已完成",expired:"已失效"}[this.item.status]},statusClass(){return`status-${this.item.status}`},isExpiringSoon(){const t=new Date(this.item.expiry);return Math.ceil((t-Date.now())/(1e3*3600*24))<=3},isCompleted(){return this.item.status==="completed"}},methods:{handleDelete(){confirm("确定要永久删除此报告？")&&this.$emit("delete",this.item.id)},handleCheck(){C().setCurrentAnalysisId(this.item.id),this.$emit("check")}},emits:["check","delete"]},H={class:"history-item"},E={class:"time-col"},P={class:"analysis-time"},F={class:"status-col"},R={class:"expiry-col"},A=["disabled"];function B(t,e,n,a,r,i){return l(),d("div",H,[s("div",E,[s("span",P,h(i.formattedTime),1)]),s("div",F,[s("span",{class:_(["status-badge",i.statusClass])},h(i.statusText),3)]),s("div",R,[s("span",{class:_(["expiry-indicator",{"expiring-soon":i.isExpiringSoon}])},h(n.item.expiry),3)]),s("div",null,[s("button",{class:_(["check-btn",{disabled:!i.isCompleted}]),disabled:!i.isCompleted,onClick:e[0]||(e[0]=(...o)=>i.handleCheck&&i.handleCheck(...o))}," 查看 ",10,A),s("button",{class:"delete-btn",onClick:e[1]||(e[1]=(...o)=>i.handleDelete&&i.handleDelete(...o))}," 删除 ")])])}const O=m(T,[["render",B],["__scopeId","data-v-ad9e8490"]]),V={},N={class:"virtual-header"};function Q(t,e){return l(),d("div",N,e[0]||(e[0]=[s("div",null,"分析时间",-1),s("div",null,"状态",-1),s("div",null,"有效期",-1),s("div",null,"操作",-1)]))}const Y=m(V,[["render",Q],["__scopeId","data-v-a352623c"]]);function g(t=50,e=15){const n=1-Math.random(),a=Math.random(),r=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*a);return Math.min(100,Math.max(0,Math.round(r*e+t)))}const G={name:"ServerChart",props:{title:{type:String,default:"服务器负载趋势"}},data(){return{chart:null,dataPoints:[],baseline:50,stabilityCounter:0,currentTrend:0}},mounted(){this.initChart(),this.startSimulation(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){var t;window.removeEventListener("resize",this.handleResize),(t=this.chart)==null||t.dispose(),clearInterval(this.interval)},methods:{initChart(){this.chart=S(this.$refs.chart),this.setBaseOption()},generateSmartData(){this.stabilityCounter++>10&&(this.stabilityCounter=0,this.baseline=Math.min(80,Math.max(20,this.baseline+(Math.random()>.5?15:-15))),this.currentTrend=Math.random()>.5?1:-1);let t;this.stabilityCounter<3?t=this.currentTrend*(5+Math.random()*10):t=g(0,3);const e=Math.min(100,Math.max(0,this.baseline+t+g(0,2)));return Math.round(e)},startSimulation(){this.dataPoints=Array.from({length:30},()=>this.generateSmartData()),this.interval=setInterval(()=>{this.stabilityCounter++;const t=this.generateSmartData();this.dataPoints=[...this.dataPoints.slice(1),t],this.chart.setOption({xAxis:{data:this.generateTimeLabels()},series:[{data:this.dataPoints}]})},2e3)},setBaseOption(){const t={title:{top:10,left:"center",text:"当前服务器负载",textStyle:{fontSize:20,color:"#2d3748"}},tooltip:{trigger:"axis",backgroundColor:"#fff",borderColor:"#e4e7ed",borderWidth:1,textStyle:{color:"#606266"},axisPointer:{type:"line",lineStyle:{color:"#409EFF",type:"dashed"}}},grid:{left:"4%",right:"6%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:this.generateTimeLabels(),axisLine:{lineStyle:{color:"#dcdfe6"}},axisLabel:{color:"#909399"}},yAxis:{type:"value",max:100,axisLine:{show:!1},splitLine:{lineStyle:{color:"#ebeef5",type:"dashed"}},axisLabel:{color:"#909399",formatter:"{value}%"}},series:[{name:"CPU使用率",type:"line",smooth:!0,symbol:"none",areaStyle:{color:new I(0,0,0,1,[{offset:0,color:"#a0cfff"},{offset:1,color:"#ecf5ff"}])},lineStyle:{width:2,color:"#409EFF"},data:this.dataPoints}]};this.chart.setOption(t)},generateTimeLabels(){const t=new Date;return Array.from({length:30},(e,n)=>new Date(t.getTime()-(29-n)*2e3).toLocaleTimeString("zh",{hour12:!1}))}}},W={class:"chart-container"},j={ref:"chart",style:{width:"100%",height:"100%"}};function q(t,e,n,a,r,i){return l(),d("div",W,[s("div",j,null,512)])}const U=m(G,[["render",q],["__scopeId","data-v-3587c2d0"]]),Z={props:{year:{type:Number,default:new Date().getFullYear()}},data(){return{myChart:null,chartData:[]}},mounted(){this.chartData=this.generateYearData(),this.$nextTick(()=>{this.initChart()}),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize),this.disposeChart()},methods:{initChart(){if(this.disposeChart(),!this.$refs.chartContainer)return;this.myChart=S(this.$refs.chartContainer);const t={title:{top:10,left:"center",text:`${this.year} 提交记录`,textStyle:{fontSize:28,color:"#2d3748"}},tooltip:{formatter:e=>`${e.value[0]}<br/>提交次数: ${e.value[1]}`},visualMap:{min:0,max:20,type:"piecewise",orient:"horizontal",left:"center",top:60,pieces:[{min:0,max:0,color:"#f0f9ff"},{min:1,max:5,color:"#a0c8f0"},{min:6,max:10,color:"#63a4e3"},{min:11,max:20,color:"#3182ce"}],textStyle:{color:"#666"},selectedMode:!1},calendar:{top:120,left:"10%",right:"6%",cellSize:["auto",12],range:`${this.year}`,itemStyle:{borderWidth:.5,color:"#f8fafc"},dayLabel:{firstDay:1,fontSize:12,color:"#666",nameMap:["周日 ","周一 ","周二 ","周三 ","周四 ","周五 ","周六 "]},monthLabel:{nameMap:"ZH",color:"#666",fontSize:12,margin:8},splitLine:{lineStyle:{color:"#616161",width:.5}},yearLabel:{show:!1}},series:{type:"heatmap",coordinateSystem:"calendar",data:this.chartData,progressive:400,blurSize:8,itemStyle:{borderRadius:4},emphasis:{itemStyle:{borderColor:"#333",borderWidth:1}}}};t&&this.myChart.setOption(t)},disposeChart(){this.myChart&&(this.myChart.dispose(),this.myChart=null)},handleResize(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.myChart&&this.myChart.resize()},60)},generateYearData(){const t=[],e=new Date,n=+new Date(`${this.year}-01-01`),a=+new Date(`${this.year+1}-01-01`),r=3600*24*1e3;for(let o=n;o<a;o+=r)t.push([b(o,"{yyyy}-{MM}-{dd}",!1),0]);const i=this.year;for(let o=0;o<24;o++){const u=new Date(e);u.setDate(e.getDate()-o);const p=b(u,"{yyyy}-{MM}-{dd}",!1),y=t.findIndex(c=>c[0]===p);if(y!==-1){const c=Math.abs(Math.sin(i+o))*20;t[y][1]=Math.floor(c)}}return t}}},J={ref:"chartContainer",class:"commit-heatmap"};function K(t,e,n,a,r,i){return l(),d("div",J,null,512)}const X=m(Z,[["render",K],["__scopeId","data-v-62185f9a"]]),tt={components:{ServerGauge:U,CommitHeatmap:X,HistoryItem:O,HistoryHeader:Y},data(){return{year:new Date().getFullYear()}},setup(){const t=C(),e=z("");t.fetchHistory();const n=k(()=>t.historyItems?t.historyItems.filter(r=>r.time.includes(e.value)||r.status.includes(e.value)).sort((r,i)=>i.id-r.id):[]);return{searchQuery:e,filteredItems:n,handleDelete:async r=>{await t.deleteItem(r)},historyStore:t}}},et={class:"analysis-history"},st={class:"dashboard-container"},at={class:"heatmap-section"},it={class:"gauge-section"},rt={class:"search-filter"},ot={key:0,class:"loading"},nt={key:1},lt={class:"table-body"},dt={key:0,class:"nodata"},ct={key:2,class:"error-message"};function ht(t,e,n,a,r,i){const o=f("commit-heatmap"),u=f("server-gauge"),p=f("HistoryHeader"),y=f("HistoryItem");return l(),d("section",et,[e[2]||(e[2]=s("h2",{class:"section-title"},"分析详情",-1)),s("div",st,[s("div",at,[v(o,{year:r.year},null,8,["year"])]),s("div",it,[v(u,{title:"服务器负载监控"})])]),e[3]||(e[3]=s("h2",{class:"section-title"},"历史记录",-1)),s("div",rt,[D(s("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>a.searchQuery=c),type:"text",placeholder:"搜索历史记录（时间）"},null,512),[[w,a.searchQuery]])]),a.historyStore.isLoading?(l(),d("div",ot," 正在加载历史记录... ")):(l(),d("div",nt,[s("div",lt,[v(p),(l(!0),d(M,null,$(a.filteredItems,c=>(l(),L(y,{key:c.id,item:c,onDelete:a.handleDelete,onCheck:e[1]||(e[1]=mt=>t.$emit("check"))},null,8,["item","onDelete"]))),128)),a.filteredItems.length?x("",!0):(l(),d("div",dt,h(a.searchQuery?"无搜索结果":"暂无数据"),1))])])),a.historyStore.error?(l(),d("div",ct," 错误: "+h(a.historyStore.error),1)):x("",!0)])}const vt=m(tt,[["render",ht],["__scopeId","data-v-81e309ca"]]);export{vt as default};
