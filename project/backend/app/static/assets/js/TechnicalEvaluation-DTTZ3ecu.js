import{M as b}from"./MarkdownRenderer-BS-UK7gl.js";import{j as f,c as a,o as i,a as t,w as c,D as m,F as u,r as h,t as g,E as v,G as w,h as M,f as k,n as R,b as x,v as E,H as S,u as T}from"./index-DGqoC7RW.js";import{u as _}from"./Main-CbR2Qn6A.js";import{_ as A}from"./Logo-DYSl22Km.js";import"./index-BtuGy7By.js";const I={components:{MarkdownRenderer:b},data(){return{messages:[],isLoading:!1,inputMessage:"",report:"",selectedApi:"qianfan",selectedModel:"ernie-x1",selectedMode:"custom",graphRagEnabled:!0,apiModels:{openai:[{value:"gpt-4o",text:"GPT-4o"},{value:"gpt-3.5-turbo",text:"GPT-3.5"}],qianfan:[{value:"ernie-x1",text:"ERNIE X1"},{value:"ernie-4.5",text:"ERNIE 4.5"},{value:"deepseek-r1",text:"DeepSeek R1"},{value:"deepseek-v3",text:"DeepSeek V3"}]},modes:[{value:"custom",label:"è‡ªå®šä¹‰"},{value:"expert",label:"ä¸“å®¶"}]}},created(){this.authStore=T(),this.historyStore=_()},mounted(){this.$nextTick(()=>{this.messages.length===0&&this.sendWelcomeMessage()})},computed:{currentVideoId(){const s=this.historyStore.historyItems.find(e=>e.id===this.historyStore.currentAnalysisId);return(s==null?void 0:s.video_id)||null}},watch:{selectedApi(s){this.selectedModel=this.apiModels[s][0].value}},methods:{async sendMessage(){const s=this.inputMessage.trim().replace(/\n/g,`

`);if(s){this.messages.push({role:"user",content:s}),this.inputMessage="",this.isLoading=!0,await this.$nextTick(()=>{this.$refs.chatHistory.scrollTop=this.$refs.chatHistory.scrollHeight});try{const d=await(await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s,chat_history:this.messages.slice(-5),mode:this.selectedMode,graphrag:this.graphRagEnabled,report:this.report,selected_api:this.selectedApi,selected_model:this.selectedModel})})).json();let l="";for await(const n of this.mockStream(d.content))l+=n,this.updateAssistantMessage(l)}catch(e){console.error("Error:",e),this.addMessage("assistant","è¯·æ±‚å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{this.isLoading=!1}}},sendWelcomeMessage(){const s=`
æ‚¨å¥½ï¼æˆ‘æ˜¯å°ä¹’ä¹“ (â—â€¢á´—â€¢â—)ï¼Œæ‚¨çš„æ™ºèƒ½åŠ©æ‰‹!

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
âœ… æä¾›ä¹’ä¹“çƒè¿åŠ¨ç›¸å…³ä¿¡æ¯
âœ… ç”Ÿæˆä¸“ä¸šçš„åˆ†ææŠ¥å‘Šï¼ˆMarkdown/PDFï¼‰
âœ… é’ˆå¯¹è¿åŠ¨æŠ¥å‘Šåšè¿›ä¸€æ­¥è§£æä¸å»ºè®®ç”Ÿæˆ
âœ… æä¾›è‡ªå®šä¹‰/ä¸“å®¶ä¸¤ç§RAGæ¨¡å¼
âœ… æ”¯æŒæ–‡æ¡£ä¸Šä¼ ä¸çŸ¥è¯†åº“ç®¡ç†

è¯·éšæ—¶æé—®æˆ–ä½¿ç”¨å·¦ä¾§åŠŸèƒ½é¢æ¿å¼€å§‹åˆ†æï¼(ï¾‰â—•ãƒ®â—•)ï¾‰*.âœ§`;this.messages.some(e=>e.content.includes(s))||this.messages.push({role:"assistant",content:s})},updateAssistantMessage(s){const e=this.messages[this.messages.length-1];(e==null?void 0:e.role)==="assistant"?e.content=s:this.messages.push({role:"assistant",content:s}),this.$nextTick(()=>{this.$refs.chatHistory.scrollTop=this.$refs.chatHistory.scrollHeight})},async handleFileUpload(s){const e=Array.from(s.target.files),d=new FormData;e.forEach(l=>d.append("files",l));try{const n=await(await fetch("/api/upload_eval",{method:"POST",body:d})).json();n.status==="success"&&alert(`æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼çŸ¥è¯†å›¾è°±èŠ‚ç‚¹æ•°ï¼š${n.total_nodes}, è¾¹æ•°ï¼š${n.total_edges}`)}catch(l){console.error("ä¸Šä¼ å¼‚å¸¸ï¼š",l),alert("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼")}},async load_embedding(){try{(await(await fetch("/api/load_dataset_embedding",{method:"POST"})).json()).status==="success"&&(console.log("çŸ¥è¯†åº“åŠ è½½æˆåŠŸ"),alert("ä¸“å®¶çŸ¥è¯†åº“å·²åŠ è½½"))}catch(s){console.error("åŠ è½½å¤±è´¥ï¼š",s),alert("çŸ¥è¯†åº“åŠ è½½å¤±è´¥")}},async generateReport(){try{document.getElementById("generate-btn").style.display="none",document.getElementById("download-btn").style.display="none",document.getElementById("generating-btn").style.display="inline-block";const e=await(await fetch("/api/generate_report",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authStore.token}`},body:JSON.stringify({video_id:this.currentVideoId})})).json();e.report&&(this.report=e.report,document.getElementById("generating-btn").style.display="none",document.getElementById("download-btn").style.display="inline-block")}catch(s){console.error("ç”ŸæˆæŠ¥å‘Šå¤±è´¥ï¼š",s),alert("æŠ¥å‘Šç”Ÿæˆå¤±è´¥")}},downloadReport(){const s=new Blob([this.report],{type:"text/markdown;charset=utf-8"}),e=document.createElement("a");e.href=URL.createObjectURL(s),e.download="ä¸“ä¸šåˆ†ææŠ¥å‘Š.md",e.click()},async loadReport(){try{if(!this.currentVideoId)throw new Error("è¯·å…ˆé€‰æ‹©è¦åŠ è½½çš„åˆ†æè®°å½•");const e=await(await fetch("/api/load_report",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authStore.token}`},body:JSON.stringify({video_id:this.currentVideoId})})).json();if(e.status==="success")this.report=e.report,this.messages.push({role:"assistant",content:`**å·²åŠ è½½åˆ†ææŠ¥å‘Š**

${e.report}`}),document.getElementById("download-btn").style.display="inline-block";else throw new Error(e.error||"æŠ¥å‘ŠåŠ è½½å¤±è´¥")}catch(s){console.error("åŠ è½½æŠ¥å‘Šå¤±è´¥:",s),alert(s.message)}},clearHistory(){this.messages=[],this.$nextTick(()=>{this.sendWelcomeMessage(),this.$refs.chatHistory.scrollTop=0})},async*mockStream(s){const e=s.split(`
`);for(const d of e)yield new Promise(l=>setTimeout(()=>l(d+`
`),80))}}},C={class:"chat-container"},V={class:"sidebar"},H={class:"bar-section model-section"},B={class:"select-group"},j=["value"],O={class:"bar-section mode-section"},U={class:"select-group"},N=["value"],P={class:"bar-section"},D={class:"select-group"},F={class:"file-upload"},G={class:"report-section"},L={class:"chat-wrapper"},q={class:"chat-history",ref:"chatHistory"},z={key:0,class:"chat-message assistant loading-message"},J={class:"input-area"};function W(s,e,d,l,n,r){const y=f("MarkdownRenderer");return i(),a("div",C,[t("aside",V,[t("div",H,[e[14]||(e[14]=t("h4",{class:"section-title"},"æ¨¡å‹åˆ‡æ¢",-1)),t("div",B,[c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.selectedApi=o),class:"form-select"},e[13]||(e[13]=[t("option",{value:"qianfan"},"ç™¾åº¦åƒå¸†",-1),t("option",{value:"openai"},"OpenAI",-1)]),512),[[m,n.selectedApi]]),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.selectedModel=o),class:"form-select"},[(i(!0),a(u,null,h(n.apiModels[n.selectedApi],o=>(i(),a("option",{value:o.value,key:o.value},g(o.text),9,j))),128))],512),[[m,n.selectedModel]])])]),t("div",O,[e[15]||(e[15]=t("h4",{class:"section-title"},"æ¨¡å¼é€‰æ‹© RAG",-1)),t("div",U,[(i(!0),a(u,null,h(n.modes,o=>(i(),a("label",{key:o.value},[c(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=p=>n.selectedMode=p),value:o.value,onChange:e[3]||(e[3]=p=>n.selectedMode==="expert"&&r.load_embedding())},null,40,N),[[v,n.selectedMode]]),t("span",null,g(o.label),1)]))),128))])]),t("div",P,[t("div",D,[t("label",null,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=o=>n.graphRagEnabled=o)},null,512),[[w,n.graphRagEnabled]]),e[16]||(e[16]=t("span",null,"GraphRAG",-1))]),t("label",F,[e[17]||(e[17]=M(" ğŸ“ ä¸Šä¼ æ–‡æ¡£ ")),t("input",{type:"file",onChange:e[5]||(e[5]=(...o)=>r.handleFileUpload&&r.handleFileUpload(...o)),multiple:"",hidden:""},null,32)])]),t("div",G,[t("button",{onClick:e[6]||(e[6]=(...o)=>r.loadReport&&r.loadReport(...o)),class:"btn report-btn"}," åŠ è½½å½“å‰æŠ¥å‘Š "),t("button",{onClick:e[7]||(e[7]=(...o)=>r.generateReport&&r.generateReport(...o)),id:"generate-btn",class:"btn report-btn"}," é‡æ–°ç”ŸæˆæŠ¥å‘Š "),t("button",{onClick:e[8]||(e[8]=(...o)=>r.downloadReport&&r.downloadReport(...o)),id:"download-btn",class:"btn report-btn",style:{display:"none"}}," ä¸‹è½½æŠ¥å‘Š "),e[18]||(e[18]=t("button",{id:"generating-btn",class:"btn report-btn",style:{display:"none"},disabled:""}," ç”Ÿæˆä¸­... ",-1))]),t("button",{onClick:e[9]||(e[9]=(...o)=>r.clearHistory&&r.clearHistory(...o)),class:"btn clear-btn"},"æ¸…é™¤å†å²")])]),t("div",L,[t("div",q,[(i(!0),a(u,null,h(n.messages,(o,p)=>(i(),a("div",{key:p,class:R(["chat-message",o.role])},[x(y,{content:o.content},null,8,["content"])],2))),128)),n.isLoading?(i(),a("div",z,e[19]||(e[19]=[t("div",{class:"loading-indicator"},[t("span",null,"æ€è€ƒä¸­"),t("div",{class:"loading-dots"},[t("span",null,"."),t("span",null,"."),t("span",null,".")])],-1)]))):k("",!0)],512),t("div",J,[c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>n.inputMessage=o),onKeyup:e[11]||(e[11]=S((...o)=>r.sendMessage&&r.sendMessage(...o),["enter"])),class:"chat-input",placeholder:"è¾“å…¥ä½ çš„é—®é¢˜..."},null,544),[[E,n.inputMessage]]),t("button",{onClick:e[12]||(e[12]=(...o)=>r.sendMessage&&r.sendMessage(...o)),class:"btn send-btn"},e[20]||(e[20]=[t("span",{class:"btn-content"},"å‘é€",-1)]))])])])}const $=A(I,[["render",W],["__scopeId","data-v-8ed10b57"]]);export{$ as default};
